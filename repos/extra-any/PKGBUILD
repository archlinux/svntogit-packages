# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=5.0.4
pkgrel=1
_rcver=${pkgver}.2
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('2cd70c414c9d5c9cbcb2f25b3c8a114a'
         '976b180f9d7f834907cddf9c7c20f3e8'
         'a9b0c0cef586df278fdac9f718bf5ece'
         '05abbe7372c7a44ca20a6bf42770bebf'
         '9543c9c0527d67a8d36c142901f5dcfc'
         '6b13e5543417ef9dcb5a1623c7cb6f24'
         'dca756e0ba2c6f4104fb7d9dc753d20b'
         '50ad47a165d77fb7125be507711e0457'
         'bf1d75b780962220f0c99117155c893a'
         '89ba4d8468fc8e5de8bba54c37079f2e'
         'f375a335e94c2c65d43eabc4a20e59c3'
         '89fc2edd56516f90b4134c42bfe803a2'
         'c8c4c923352b3083a7d08eedc86f77e7'
         '6c0c8bee29d083e4df7d29393cc370f8'
         '55f4b67d7e45b744feec2a9dd157a0f5'
         '61bb2940f0fb276d6799da1417e7753b'
         '01a923069e34262d7f1fa4fa53c59c72'
         '30584fc235407299ef13974aaa42d5f4'
         'f57430a83deac70a240b413453e1cec7'
         '85be004784720043a13dce8994f63fda'
         '208c60e8c3bc5ca2cbb61e2729c7fdd0'
         '24674d960898e30f73ce9c543b87ed5c'
         '74a244055fb366da4b2c6c32b1b697f8'
         'deb2c303ffa1c03adc7a1710101816f2'
         '1522e1db0d8e0d234c7ba2f574654b6c'
         'f84885a8244701672b398e19e4b743ee'
         '66826f4f1036d8162ee21cf110ba6fbf'
         '2dfc542b77f5f51e8a0e434e0b4a8699'
         'c073e697c648b8dd1163bb302371b944'
         'fe8635e60c3d5228055136d78e55472b'
         '212894c0f16922fd8020ddf8e728effc'
         '349782867e9cb2c80c5f4aff25347217'
         'f6635857221d78a7ce9aa9f2e45ed55d'
         'e8571081d08cabc0de956bafd9632cce'
         'b553cce160fbd76d42da0d941af4efc2'
         '9c835864861ec75612a0757d6229681a'
         'd4d179eab325a3d2840025300d0be0a9'
         '72b6bdf258eb5342b81abd5bcf653b57'
         'f2b6c3b61b0e5d368e5d525d97fde879'
         '1425c7935cd30f48b1b83a02b6359615'
         '2bc9dfe09c701154139ab5b2d676d368'
         'f8e076f884209fc22ed280fc58869a7a'
         '16f4867aec78a51e1cb7f028043b5ff5'
         '6d28aaf189a29a81f4bea11bdb7ab3a1'
         '30fb346e28eac77398549cf7413762db'
         '3e4411e00344980196fc2d460939a652'
         '643d4c2f0de1db203ea0d54aecba1c27'
         '11c21ba780bc09f7752e2f89862a7874'
         '76ee8e39d117fff839fa82739cb8e557'
         '2a0173f0936f522caba3c338350912ce'
         '99e0ee838ad2cb3d83a7e6f0348fca1a'
         '88afb8ec9897083700c08d2fa89ce640'
         '4ead53383bb7df434ad8d24947afd556'
         'c58cedfdf0bbdd12c0cdee33b49a79b1'
         '9dc4847847f9e6a4323ee01911c2928c'
         'b9903efa5b499a56b0432876f7096551'
         '87f119a61df46ede14f81c1c77ac4bc2'
         'fd86abfcdfe9537eb46fbda734bd3c1b'
         '7c5d20f143be3b336a733611431bf6c8'
         '3ca4e19e6897c464e30b10dc300af02b'
         '43a42f63ee338b6b12be462c2d88f9de'
         'd48c95d5363c21c9c7e1fc56945c7d15'
         'fea272b0533ed1ac57b33dfcdb3b2ce5'
         '76cc4a9fe5a27307396161d096476f79'
         '82d5209f5d23cceaac4ccf580b6413bb'
         '645bcacb19f45968c74dd4110a40e44e'
         'def684ee70b18c12fd339817e9d961ba'
         '78c2a4363d4c0d2a1b218b4e666e0527'
         'f8f1c999ee70c2a26e294308745cb460'
         'f389c694a2923fd2aa8c417b7244ff47'
         'eb587a28fc7d30e1e1fdaa6b5e6a7723'
         'daaceaed31880a5643552783cf1fec65'
         '9e73d810bf61fbda32f586b43361d2ed'
         '9a3cfd9f178def03568834547dbf7f28'
         '29e8194797a29d797b1d55f6e0f12ebc'
         '20b2231cd179743b16128c9f2c06bec4'
         '253a964e0a0d66263526e2f457d5392a'
         'fe07267f567b481323a4976e680e3327'
         'b37321d03811f07ec31e03a4caa442b9'
         '2f64cd2432dcdbbd754cc1ac36bbdd65'
         'e713fc71b2ccfd758083b365b700e148'
         '3558be694748e6eec466d37ad71f8853'
         'c47f21327461fc7dc41b64507993891c'
         '5b443ed4b1eece760a015230cd3d7b23'
         '4df72a18614fa666b0045284fdccf11a'
         '63855b3a4cdbae0e94a6d0531189b6c5'
         '1a52fb537216bb14be4077c8ff403714'
         '1d0804e0d7f0b0a7ba775facea9d3ce1'
         '5e325cbc2d0f37364a55d4757aa1718a'
         '6cf2e5d570ae4e1faaa205d0b9402658'
         '5c2891e36b7f607ee3942bb48703167e'
         'b65535dff1506835a058f8223184471f'
         '0785b24e13fa252c67f4c71dd8de7eb6'
         '1b1ef7273281416da37214dc72f89208'
         '41d5d5b24203d669d1751758fc5707ee'
         '520cf775d46cd9b1da529a2a563c27c1'
         '2261088550e2e8d7882d67efa0f47f68'
         'ff033521156f161e33f3e4482edc5b13'
         'bfc20ed5a16997e8302f297316c7ab15'
         '82c78c7e4dca2bcd9cc3eb5c809c004d'
         '46c1c47ab94afde3b2ec192d7d3af7ed'
         '644c500a2d47b82ad05eef8fe749a518'
         '8b20d54b8148298b34083d9756c37be9'
         '7812a20fd3b2ad02572298efb7f0a7f1'
         'cf1ec21c317dd1a24230431a16b6328f'
         'b76b1374b7219997078068f3843a98ef'
         'd67e98f5c40038fd86bc905eb297a899'
         '43ad77b2141ebc0491b371798f891dd9'
         '48f6dece0c94867d9982c60378a7c0a6'
         '5573dfb56bf5e49ceae46744149b1a13'
         '842897c19bc523f23f2585fc81c161ca'
         'b8087641fca3b117f3067d659961e348'
         'ac294c4f404ea759a76e924f563b22c9'
         'ff468f81edbf5508b0c4fa14a3dbd82d'
         '6beb750643d7403ed2fda071576a3466'
         '52e08684c2ae67cc720757d5c1282cb4'
         '3566c3f8010a4cf841dddd7ff97b1e7e'
         '2acd00436bbdcb2dcd58f417b0815fe8'
         'fdbd0760da9ffd90ff913daa5671d3a3'
         '6f12b0a74c064f45e0edd9da84f74d3a'
         'a5edf36a74ec01ff870b334eb0609b5b'
         '165ed523a4d30f16d952b39d6088fc6d'
         'd756747add56654a921bac6129344028'
         '35cc6389cfe4198684a26f73f213ee82'
         'f59de62351bcbd3f854349cd9dfc18b8'
         '022c65815b05fd944741c0339799468f'
         'b52ce5aa520b3019df2f24b9f7b1e858'
         '355ef98db5cc2edb21bca05d150b2d28'
         '294b9c5bc22cd126e0ead8b4c02db074'
         'aea7d9dc0cbfb028de077b69737de5ff'
         '713ca0c29f00325f4291c41ab3471fa1'
         '1e107cc39a08eb015046da26622b4ead'
         'f5cf358309775362cee2ac4835a0cc3e'
         '0a642bd3844109c39710d4811ba7fef3'
         '0019b61b7d3689411ceb61951f187f67'
         'e67ba8ac4a557a521326f0ad53ac508d'
         '72ec186197c8284a4463a7bb6675b225'
         '58ef80c844faea63061907e9b494b384'
         'dcbd2b72f602a8df410bfec53270a5f3'
         'b22644534569e934feb11e617a3cfd6b'
         'dfbf2750ec192bece39571bf9f85cfe3'
         '8e9d2da997b0f9fe518b021860dc5352'
         'db8929271e623f175b4666ca98707bee'
         '4ea5ae7a6f3952c503b6c5b3d81087aa'
         'bd6a4c46b77cd5e3d1af0ff492650d04'
         '8fb32fadaacab56628b33d1374d463ba'
         '193f31f08d32f7883ba67a5ea9ce3cd8'
         '0ef2f28cc9d280e3b618e917b71424ee'
         '183597cc9dadf6d1a77d319fa457da48'
         '9772c9ee7f33bf8ec4f613136fff3d03'
         'fe30ee484a37deb7b4c81e307dbcfba6'
         'e569b5a030430bda6efbb5967322d82a'
         '86d0651485b5dd858aebc3922c8f482d'
         '41dd2557207a4616a5d5a78a13f8e66e'
         'd91d63b56701b482d6b203aa3f526abb'
         '73a2e8209a912bc813c71081715c976f'
         'c91356b450de5fc2f75c4dbba4b7a520'
         '3952093d0acc19ed7e1ed84d5f5d7064'
         '6840e6b772c573e74077e0ac4cda1207'
         'eea27e77cce17950343d39b9925ddbf8'
         '8109d1f8e58080685f62376c8ba5a545'
         '59ef2a35137e907dad995a9d7c6691a0'
         '4ea335bc035029d8eee5163fadcc9a02'
         '21d2d3565f11cc2242c59096fddffd0d'
         '5696b8e158e51f638f2eaf3028cabba7'
         'adb2f061883d604ab61d5a682038f46e')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
