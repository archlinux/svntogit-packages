# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=5.1.2
pkgrel=1
_rcver=${pkgver}.2
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('62443cccf2dd3ec828b0c676b8c526e6'
         'bcd2e59db2523559dc8e1e8bc4d41f98'
         '91946eeeb52e13cae47051b0c8e190bd'
         'f6a3547a1205834e2bb8e30a53fc213e'
         '694c24cb56579ca93437f78505b26b23'
         '1ca3add4acf471cb9764d146a191ec24'
         '3103503450ddaea0afe0748cd0e5cc73'
         'bfb5046618a7f9d7a1be9194bc78e165'
         '20355a021624c92717af96703069b57b'
         '7b71100a5f1224727feb5dc8d6c3bead'
         '0240665f75df4512b62cf73cf5310cff'
         '3e91064f8078ef9460437425dd13ed05'
         '57455b26723f2e682572bac64bafa146'
         'c4bb18c3cc88458b278ae28f8e5a726f'
         'cab6f08c8b72a39dbd7fd569c8241be8'
         'ceb0d0f0e40ce9095e2f9dddb41c9270'
         'f7e6252341b27474d400cb4f352f2689'
         'b6f346599ca0858c00f1a77e3bb8a2cc'
         'cac957d5bf3544fa9c97970e21605540'
         '74ca8e57986902a860f570cd17d6fac4'
         '1f498216688a206d5087ee2e2bae7c94'
         '1f44939a0439649476a514997612f308'
         'c6b9c6cbd464ee957865f42455f18540'
         'fef0883e1da0612da76d6d171ee92b0b'
         '6a9c416d71acad8d8c5b0050fc8f490e'
         '7bde2cba5bfc57ed63585058dac0705a'
         'b6dbf565f78717a2ca20f03805098c2f'
         '4afcfe2dee80b1ee4394e91f552f9335'
         '6fc7d40c7a8b622c0755b0cc491cf4ac'
         '124a4734cb7299956467f848c645e47f'
         'a0a660f4b3749d59e7c86793b71b31c6'
         '261767f505a9bef229801e6e1ba52e9c'
         'f6fec942ad1b12f905cbf9d43c20ab15'
         '6d730ff54b70af2e4a006537d5380b8a'
         '3f25e275fcdbe687db10a435577952bc'
         'e59176526a9a2014dfd74b21414b9337'
         '474825713a10b81f317cfb9b83cb1be8'
         'b8f8a053ed3b759f2c555c42ef6db059'
         '373bcacea4a0cbd447e90e1f280dd21e'
         'de896751cab242c4eb194eeffece5d1b'
         '6ba5055bbcb10269c78314bb28c50f2e'
         '02b68cd321ea902410715e1e281d057e'
         '18140a81009b8a0e2803d6b987607cee'
         'ea94cf523bce5cd1282e195b91306884'
         '75793afb6520f433eb8bcedad1c8dc95'
         'a78180bae780ee4f3b5efb799ce03aff'
         '92e15977e2953dae480ca0d1419c09a9'
         '521beaab8834cfcd9c9b998cf77bdadf'
         '51eeec19bc5d8ef4d068ea3659f052f8'
         'ea78263ecc06bf720e2d759ee6c1fdde'
         '0df05733bc0caa3d2f53ff5555d483b8'
         'd6ea625548f2fec0bf861b44913e1691'
         '801da1aa6b1b0556871dc6b42d581a90'
         '853ed951ee3d021be15e782f238e92c8'
         'd4f6873eef9833d47b31d15eeab0c616'
         'a6c525031861ee2da6d7863bb2a612aa'
         'b6095616aa0dfb8892cc998abb233c7a'
         '2d04ec82855e7bd90b780f81042f1924'
         'ecb324a09c6c836abbe58d1e8c647aef'
         '04e580b59b25ee56cf41da61847d49ef'
         'e7f9461f5c5716043fb4a85cad143fe1'
         '5843fe6e38c0f54a72a35aa3bbb04141'
         '9a2c23bb0f2999bf7498496346b4a100'
         'ae3ad0153e191e427daca7170330b71e'
         'a372899496d2d249c64c816dc19cf6f8'
         '15ca597f0a7f02b3380c6e2b836a2ea5'
         '650b0b363a44bbe73ea33c15572d57dc'
         'fce7683c06007d17ff3adc5628cce745'
         'db8b9e1013bd90779e256527a2ead8b4'
         'e10373ce2c609a4faafefb6433440879'
         'b0270d827c92fc09fb2a16803f64096e'
         'b01f57815eb2d96ce411d7ad06aa0700'
         '68a5ffbe226b04bbbc7e9c27e646f8c3'
         '078a6782be89e7b1d7abab4910600181'
         'a1255b5c5cb3aef351192b73fc48c837'
         '6eb5b4646ded7c40e91f71c25ad98be8'
         '7602612bd765048e0a3f6c3783fd1c81'
         '334003d8307e27fd6a7ff92d3d5a7cc8'
         'fb5a4c14f7c39c10839db61af4f1d834'
         '22b5b1799bcb9141809b2c8fbc082154'
         '1574b1351bf6a4275e0dd40ba0aaaa04'
         'c54f104ff0017590b283a872ee245bdc'
         'a417434d92e6f584305e93eba5c5bef1'
         'ba50f88c689789db07c39dbd7aa441a0'
         'cb8414263ed270e342bdf9b1d64c3b5a'
         '9f1ed17ad8aab6a320361719a78715cb'
         '274be4013ab2877b10247e10b859f8d1'
         '39a2ec21055f810fa4b479e1415a23a3'
         'b9e73706ee6bb62c67263a82cde4b600'
         'e456ea17358e6ccd661b53620d200343'
         '117c21127028025b5ee6bb5b69f4408d'
         'a9787516980df274b8e3f3b04cea76d8'
         '098b432d35acf2ebfa6728cd2a010497'
         '21d16711d81ba7bb28f0a52f823a7345'
         '878b2f5bf8c00017c0cb0fbbad9b275f'
         '4cf9ab2b4dd57d174a2d7dd7552c0671'
         '61337d99ad89d785c1083ecbcd5b4d43'
         '6c866cd80b95b90f2c5dbc0f9267addb'
         'cf9375772a55fb4e02faca1def19a028'
         '21c886d9987fdc0764418317cd33723b'
         '713dc17c670fcbda9f9a850098b365ad'
         'c70e0b4042d0542afa282e3dd08ad369'
         '31ef4371f248e1994dd5dd0b86998733'
         '492c8602e7d34b79939ca2c52401d6c2'
         '5678ec50e5f577b6bf05c7371c47cd6a'
         'c0929e4c48a5a93f25a51673dbea0315'
         '81ff8e97fb65828daec7a5bfb1c8abaf'
         'ae3f212c1a189b17a68f2148c1aea516'
         '0bc63c676921837bdee7bf0d3ba62db5'
         '8f4ac4c9b5616b7d27134bfa28d01e08'
         '64c716572748c29f5ee2bc70f9fc0add'
         '91fbff0090114f32d0918929a3d42780'
         '8d08fd8974f5471b59edf321320f52bf'
         '3f72d0edb91faeb27998bc7a0b7c542d'
         'ad70465fab2200fc3b1bdce9ab3f0bc8'
         'f0a9af41d3f3406d15d1d97ce77b5cca'
         '5ca9c6b742bae3c78361b485202b7e6b'
         '1373ff198fdde26084cc73f05545ae65'
         'a262f6ea4639b2c6298c091614e20eab'
         '3eaafa2b6989657b696dc8b1c0bc496a'
         '40d915ec0109c301640219307830fa86'
         '0c82aa5954e67dc4cacb9dc211517aed'
         '3bb66cc04ecd9f039b2845609041e2b4'
         'fd85ebf44d40c59e3d009a7d0d33db5e'
         'ae95cd3240e1406ce6eb6a620aa4db9e'
         '7675346c9fc82c5359d85a7ccd118deb'
         '17c0e2155c996f5c26e16f459a373d16'
         'f533dcf2fbe6418f58d22d1ca6fc3b3b'
         'e9e7342bbb7ce7cffa0ce1d2e8235a81'
         '3777c0f22e2ce726a61f06673127eb55'
         '48eb4a7e821908d1302820709eb1b9a8'
         'dd107d128df39fecb40ab1779ccdfb64'
         'ab953a1186326ac77d084645d259b8ef'
         'e9dcc9103008bfd23457848cdd7e0671'
         '3131ade5892d25047a64f620ac77f540'
         'f0cfc716de11d7f6cf69274e18bc2c7e'
         '30caacec1e520843356622e9b9f88fec'
         '68431453c0b39f5e6f068e381b1bad44'
         '8e3e5c29bcb4d952c26e9841d36d97d9'
         '6ad51dc2f6cf1ad167266cdc3f958f21'
         '51caef2046c906082a715ab0176eace5'
         'c27dd0fcefb5ec9daa777528bd0122b9'
         '7a73eef7088b88fe01302379f6eae37b'
         'b1b76732c7e907b483ea0a1d1d7a852d'
         '942938e553ae795f1ed53dae8d70fbdb'
         '2ec4c96a0ba2224e818a897df2bbeea9'
         'c7a99a211b303a686ef57cc6870f1d98'
         '227459960b714790fd6fa33182abd459'
         'ca52d91405e3e5361d4e5678692d5784'
         '52ca582639f7c88fee298f2b6e8ed352'
         'd173c6b78e4fa7c4d9e314bfa9d74670'
         'ea6429e2262daa20794b4dd1b89218ad'
         'a62a49a1eabd2ecd8f98aeb004828cc2'
         'a5ee52ccdaf0ce19fdb3635aa3e8118c'
         'f43139195b10b688a559a927f6d7973c'
         'bb71196bb57c128e7b9ca0f14d12fdef'
         'ad2ad390db873af95f1d54d97912ffb3'
         'e089f886abedd0a0f964a0a291749c9f'
         '70077756a6ba3b8a2bb78f3595a3adce'
         '1d225875bf89871d8c11a8e177fdf132'
         'd2b2c32d5fd82fb028262a14cc289507'
         '7c72a0cde295eab543b77d85cab81aee'
         '7f569ca4f5ba27008a4b005b7049fb4d'
         '5c3965bc0a08b4367c3ad923b1fdbd03'
         '1fdd8dfbe29d0806a1f89eda67de8969'
         'f3a0d7ec96bdfe00d8d28afbcea3fac5')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
