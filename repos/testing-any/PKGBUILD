# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=5.1.0
pkgrel=1
_rcver=${pkgver}.3
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('f9e799ed94110ff1ea5d58f695f80755'
         '6aed732096d9fd5eb2bcb409c1c68bec'
         '54abb5c38329640f6c83b6479a17b780'
         'fb814b7643df35b68554f00747ec87e5'
         '6ac34c7b6cd59e84d272557dad5d5692'
         '547223d2233fc45947efccb50a34d2f0'
         '774342df4239b01f1199480e02ba15d7'
         '4a08edb16092a6b631802033ab21535f'
         '239435f5748fa0d68d1843fea34e9f8d'
         'b6d2c9b95cc7913aba42515fb660d8a5'
         'eae56938caf2fe9512e8e02ad9f97501'
         '3a4a1c7e5cb3d76e6c1f0c9dac1ccc2c'
         '6eff5fcf0b94815bcfc3af2228e6a85d'
         '7cfdd1fcfbbe15f5a4fc68d047dfef8a'
         '43ca8003a1505e25a8883507583fb919'
         '4d0c951ef45d8984a1ef1afaf9a2932f'
         'da863598bd14f745db07fdb2529a52fa'
         '7339824aae23f308a251ce9d1fd45f3c'
         '447c809e8396049c0461747d832c8105'
         '6b0e0c8555f1f82dc0f251fbc97b4449'
         '4708b740ddcbcb53d21d00e921370b13'
         '748ba772d65da89d6fdc402ec1015858'
         '186b0529821c72ef527ff7d269da58f5'
         'b1136b9d023b4074f9f73716066c1355'
         '5da2aae9016fbc645a0541de02fe17ef'
         'b56640ef8aa81b501d593aab0e423f5f'
         'cb0d1ae4d2fc4be3bcdd8b8b12dfc402'
         'c2c23b16a545b48af774abb4594e0ba8'
         'cbc4638fedade3bd1ab49998789c968a'
         '7cdcd03ff70886e798cef710e42da054'
         'c889c69b170969140efd0856503c189f'
         '8533545b16487da46ea3a03bcde52c94'
         'a79135f16cd5c780c8361706a293eb6f'
         '4782a35a8aae15e6e31248041fc7bf41'
         '68a17e2fe80aa59c69d4749efb2ed56c'
         '019a8655f677ce198f269c631fcaefbc'
         '72d9646eb21eb23aafe6fc7fcd18294d'
         '4a7da398e7bbf0be5b7fad35dd1a4fdb'
         '4280a9ba45c4e7e7c6c9d7f41bd4ba33'
         '9bf66cf77e26f9104e34f78bf921872d'
         'fc5968a5ecd8d603a7faabf8946ace5b'
         '51453e1ef4aaa415f681fae5054c7df9'
         'c63ac20eda031db08f1754881c36b8c8'
         '9954c225ea441766c00fae5abd849daf'
         '5f0a6cd9f04457d07a8d40a40264a562'
         '0f3df333366d542ca429b2b73bc2ae1a'
         'c87fded1305c83440675a585daca7d58'
         'c39172b5bdd2de77fa18c36ee6356fdf'
         'e110c9e81a3b85a180d08832d208a896'
         'b32e5086d2a9cee9e6291ca2d005868a'
         '254dbcc0d47a69686e73808ccd14af1c'
         'a3a6fccb051a8d4933b63246ee0043c8'
         'c16bebefd85f756fa108400fb590a121'
         '937b7dbfbbcba8979197a8272fbc9bbb'
         'cc9a9da8d76e50bb423ea7f0a38151e9'
         '6e7fa4e7347046a5f760fbe2e2917bbb'
         '08ab5b2a594ddca77f0736c8a8ead8b9'
         '87dd2f99e988a06c961e27a8e88af174'
         '7d0f00721fcbac0fc990d54f5cdd48ba'
         'f6cd74683a86f45b1f5bcea2476761b4'
         'bfddad6c4ced62c1d52c7ad00c85be5b'
         '6495a22ddc4f3a0fa2fead386e0065cd'
         '64e5ceaf72c38620da4414c1ab585a6b'
         '32fa788d71196807589c4e9080f71fd1'
         '37b3b1cc45d685b18d43276725702f6d'
         '4bf3d3995686f22c27e25db821cfcff3'
         '8513bf57a025702c3cc39c6382715aeb'
         '2b6219dc63a4e39a9602990f5934024d'
         '14090294e016fd84f2a117f44ba22a29'
         '7ff5d3e245634040a8c1d0417c33ee2d'
         'ceb0dcbd1ec8d8b474b80f6957f33cfe'
         '72c918118aba6a066b5070167f344314'
         'b94d06461838a43e74755c17d663df89'
         'ace4c4dfa7dbff9233ff014b875c244b'
         '9bb206aa94f4d398112562495dc031a0'
         'ed6e1a9ec8785e7c653cdff612127d59'
         'd7d645de999bab203ab66ba2e94b7731'
         '84d32d6030fe0d80013bc8e6bf56c2c9'
         '51c335f18d27afa7b9eac7b6e41c049d'
         'c57b6ac4d6be0dbfa5d26a454a458b17'
         'fa0d360472e3f174ec1ee10cd6ff4c89'
         'c93ef13fdb2a8103c775df6a86f0cc39'
         'edb7d47cdf2527d414adfaf79072332f'
         '15ab2090f51f8cedb9f743ff8e30e432'
         'e371cb14f0eff33590a829dfa2512c70'
         '777fbd274b30632f412159f3f6d216c6'
         'f689f984bfb68951f374894e06fdeee2'
         '9d828e8812bb7bcc17747f950685734c'
         'df6999c12e05d96dd68b5f4a8a8c3e74'
         'dd1f82d7b2d8ece014dfda7e2bd1c7b6'
         'd76c6c5b8a9333c1f9326ece5517629c'
         'ac113b110d0bb88c2f1ad7bf60d6ad95'
         '953a215a9511044f2b663af4544bdd6b'
         'd0ec4c35b7dd9c5e526d5ffbd5914dd8'
         '92ce7141a8c70114205de516deb85218'
         'bd0ae5194132f0ccd7fe2f5bc00a9d69'
         'bf434c02958889f418957a5b03edeae3'
         '7d7d0b37e16271edfd748e9edb7da6e9'
         '88ae6e97311264c7fdb53995cd1f4c53'
         '22523c3647ff972a72624a250d61735c'
         '5052e2bb5a3e41a64767316213d4aa9c'
         '08427bb91ef7ca36d1ec670c0232e1dc'
         'e9e91ab80bb11b394998b346fd5994cb'
         'ca37b445949425f67df65f5f68a02aa0'
         '81e799ead771eaba2f28cd684693da91'
         '6f160c3758348449068a36cedc1ba802'
         '3096c066e0e84f92c65a7a19e9d83c06'
         '6b784e98384613210bbb338e2919e148'
         '593f0ed0c93108b40f31b7973ab3fc73'
         '7d730dbf0a337016dda1a72d719f3644'
         'dffca4d07ce531d97a6525f3ad36ce6f'
         '8831f32d4f418244163aa836719dfbe9'
         '8a39267df9840ff471d6bc352e356391'
         '17e63ab76cf5a9b7440c8a54740aa408'
         'e2eeb18736353f5ebd015ff812d2852e'
         '0a0fcfa0cdf42b3d0f9d430d682c43b6'
         'b3486bc8de25da70ff64100669f7e0eb'
         '81bb9ccd574b1bb64cc47af7658646d8'
         '9912a4363da269c093eea9b34551554c'
         'eac1ca3891f0729397d6acce6219b3a7'
         '602e3319c929e8b0417fdb416ff41d21'
         '8c3e3bc97c1efa38c6cbe76fa7a0706d'
         'a970e43df7fcecb98aee9e43905b48a1'
         'fb2697e0a607a22791d704afb79b48ab'
         '987a62f4d40b131234834ad8ffdec5b9'
         'c809857f82037b9bfaf6160eda28810d'
         'e82eb1714161efb18ccb2402bd1927b9'
         '8e667393ccac5e9ae8fd3ec6a52344b4'
         'ad934c93f489476a26bcbd93f25e84f5'
         'af72bdc866452c0215b307894a18c25c'
         '2f052bd5b0975fbbfbe90ca6c3355263'
         '5d0e36463969af1e7a7d5e3aa6bb3bce'
         '63cdfb1c2a40d6c7d665dfa594a331b3'
         'ccaa3d6c3accacb34894149688a51a02'
         '0436a2c13969a1830a69c08bd7620c53'
         '78b04a29191feb70a13c1be7b7b7e85a'
         'e2c8e1361bdd3159ef2accf0daea2593'
         '8b6f9ef19bb64a6f7d05e37e66b4f7d8'
         '8c494069283be8ef54169045af105852'
         'b8f7153313e98d6390b778901e35fd47'
         '27841b1428209113a7899dcfd7aef970'
         '5d62ef0f3f59dc9d7ecc7fde0aac39ee'
         '39ab36f936007f0def186815de5bedaa'
         '74bad98cdd66ebdff9689508b0f42e4f'
         'aabc9775e6a964da4b0629af5d1638a3'
         'ed1130d059f5c5629b7a207c8029fb40'
         '72c8706d6eadbaf358f472e445a4516e'
         'be206789e8c501e1d9fb08b9d999cdaa'
         'ddcd3b5dc816f2b6951453c30637bdc8'
         '9387a204bf74a683c90d34867577d79a'
         'a5249d0d4927ad0a6d8825cbb5a8bf1d'
         'aeb699638b095b60885ad63f84f8376e'
         'e5c3facf2b8cfd4e0f272a307f1c5999'
         'd152f33a40776dc6a16d447a7d05e002'
         'a13e50bfed74f50d3e650c2b1f61f1a7'
         '4dee33ec23fb00a7dab2ff3795054da0'
         '0f6ef5eb28e521c0a75070d69fc8818c'
         '8434e86e83bf7531c76b62347b398163'
         '51b9bd5d0c78da746fb1490e5c123a83'
         '8ce9af6c1cb194068b005371c6b8ae6e'
         '160774639a49efbeb93bd430776a3435'
         '3b5eee3f89821ce6470cff5c9ee5853d'
         '53a6ca8372fc846e9a8b04e945596832'
         '28cab57a38f85be16d59ea1a1145dc02'
         '3175a53e2d577675f33627f3b3faec88'
         '295bf75f636a99edd5f33393f68e7f3a')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
