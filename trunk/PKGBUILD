# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=4.4.3
pkgrel=1
_rcver=${pkgver}.2
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('f8853a2e464cd2282d1d7ff0807e5a41'
         '6bb8a74e9eab7bb7a530d714c0c59349'
         '1c9d1bad01a6c12af763f2bbadd96ed9'
         '8b46db7d9f2c24891a7ad8e99ef63fe6'
         'c789f636a872567016bd88c71dc513fe'
         '88040bf466fc15fa3e0ba06138c4efbc'
         '39e518aa15eeac235b3082456be7c346'
         '07eedb79b255d91c4216029c2905f836'
         '151fa90dc564222d12d04c063252d5fb'
         'ccdbda24000f5f6f6dd5c350d9d9ad61'
         '3969303f1af9ce6fa544b1498d1a5a7d'
         'a354d0acf546049fd26a581e6637bafb'
         '5779c4ce50bc10b471a33f7b798f7a1a'
         '482b8f003da832da3683b1d66da13789'
         '093d23efe9677684bc9545faf43ba106'
         '2b156179c8e32e1832f3b4284ca09116'
         '7ab1d6c79c76c4960a8c0c7d55c13a75'
         '844b2514927e63fbfd3d38387cf9856c'
         '7de105d7916b3a91ce622dcd79f465c4'
         '585fea0e71275148cd701dc3136f9fec'
         'ea3835a7a0753c149f46a61cee3c7aba'
         '4f9b3f44aa3e887c96071ea7723bb344'
         'be710904de031266109a01c9e3af6c1d'
         '4b87d373e79847ae28d723563e1e95a5'
         '118332a986d1d3e7021e9b7428f2775e'
         '527cb49dc6d3d83c035c5b7179b8428e'
         '43c2aadeebb79e3f22d9941988c36262'
         'ad48dbdedfe4f388a9d2db61bb9c820e'
         '70f730e11f79d0b0bc1e664da27d29c5'
         'f790d410f31059e30dd24c9ff00fdae5'
         '62b73b584b664ab428327b40b20c0c67'
         '1690934620ff3b224db75eb222159e25'
         '0c0e8da48d71995e2cae39b187606aa2'
         '7d45dc4deee8edff60df131b71fe3c81'
         '0c35b232700e587e1b86992568026d8f'
         '04e4c5a945afdfd2a1c0ae87b6ed2e62'
         '689d31c2f775bec58aa061e95af00a83'
         'ed030f623ec5c5882c9490b01bd95b96'
         '8f8c82b315bcceb73ff3761895dfcbe8'
         '6257c0128f40cd0c7d3116fad198fb86'
         '7037414eb777856c3d1a3e4eba5650e8'
         '3f4187690645b632d3118b6798089850'
         'e885757ff1cf915a2e716fab268fe97d'
         'e49b1fd9488b4e04a89c401584ca5e55'
         'c9db4f58129c496ff2aa2747ce21756c'
         'aafe6f083b859b4c23c5955ea2cdd8ce'
         '15a13773c0d208d005996237b3fbc8d1'
         '86a749130d4a4262273194d41842835c'
         '31c862841bcf2cc18bdb372f5ef72b4b'
         '1497c29f8bc8fd5177579ca9abe5c42b'
         '8674e5b0c6a7feaa0b0f2f56f32656be'
         'c66d35c2703fb68dcee22601cd98bf1b'
         '16b1d9d4705516f16bbb47abaf56e5ae'
         'ee47a30a123e08dc77407729fab56080'
         'a026ba6065b7bb667e3e706f7b7b9252'
         '748df5ec0db2dc61926d1398449a1e68'
         'cb720c57e86d22aa7393fc8da8242b80'
         '102b0baca88a9db6b8c56d19ff5a7db8'
         '4bfc42738b732a9b45b46d66bbf94780'
         'cc0d4907a898aacd20fca2effed315c8'
         '1b6827afa2f5f29571a83083224ccfef'
         '0a5229ddb91396ef69d6df99ff96e221'
         'fda0f53bf092b9f5ae0994c25e0dc327'
         '2f04ba5eca7c59cf573ef0a408047caa'
         '41fa7500ffd90ce02a060e53ac3862a6'
         '7c7acab8848951c8ffee22a5392333b5'
         'e587db3bfc33eb4ac0617e3fd1497ff3'
         '3bf04c17f0de48ea9d43e7ca7f564048'
         '1264f6cbc044b412ad50c70eaef3d687'
         '416ed1290fc4a619beae5b96f0fcc47e'
         '799407765a4670be0c52d4c211868f6b'
         '244851ebf5643b35b944d6444dea18b0'
         '29d20a43d14c65a5e4d8920ab22b42db'
         '20287493c36b516a99e337f9100dd0b8'
         '9892c7a13f26a8d68632ac2559e5dfe9'
         'a0867f687d99dc32a7a0c5e9c45a5a79'
         '9b47d13636f4238a16ef512722279656'
         'f75246e6f3527395e321473541f4afbd'
         '81e89da80acc181327b1a98e784fec02'
         'bace6295829e8636880ed66980c67b35'
         '2d13e7e726512a8c331a274c9c0c1ef6'
         '99adde013f4c959a8524c0f2cab3e8e6'
         '5fe293242b7943d293880a434af38fd2'
         '2396d673af63858ee26fc5d1c632a8a8'
         '98f50b6cd4dc005964484e04bd759d3c'
         'b094f9d5776bb29cd493d473c16b26d7'
         'e25b30c489e584e208ab8ee39c0f6b68'
         '1a0a8826f480ae07147c8cc1cd4c0763'
         'd3f4b1055aaa2e9a21e253f7b3dff941'
         '7e864ba431bdd8c6deb81250c3fc9d7b'
         'a85600664cb82f571102143985b775bf'
         '509e260d58d3959e601336def12cd71d'
         'f5dbf2f2498737f310b25da50ab3cf59'
         '256c345f4cfa7d730abfce02df842745'
         'abea5ea3563ac892971da547065b6788'
         '79ac0f874691b7513f1957928b652f64'
         '1c5525262edcb46c6bf06ca20aa86fbe'
         'ea3ea0fb6d65f432a84430c0e014e429'
         '173b516420ff696d4d39b1cb448df76b'
         '2e6e42813e51d86043f1e738f4728c36'
         'f6b4ab2ab83ee287454c1225f2e784a2'
         '10047cd622f4229fee3040a71e13b6f4'
         '42169c31693849af01184e245a4b892b'
         '46ff97d22a925bdb3658e7e48bed1528'
         '2d03890aa1bbc0a9d9a41f101c7499e0'
         '776beea19e95ea99a6b146730ba8baca'
         '5b8219d9297ee85c4e45bf0a3f4bb3a4'
         '07d3acbd344131dffa64f6c214f58c60'
         '16d8ec7fdc28d2e934fda0b1fc891778'
         'f9e2f816d35e8b3d2b60d0eeb916cdb3'
         '03809b3a6610cd1fdf82e69ec7330175'
         'beea858a4ca8096886925724d7442cdc'
         '26637015e3dcdd7466eac0ad826d09cb'
         '8395492744d93bf352a699a2baa32c26'
         '6a0c4fa45802e156189abf10b3012da4'
         'fad6b96290c0ed527597422192b3c199'
         '19e58a35d1fd2bbdda1dae5199b712ba'
         'ddd8e58ec0096858bea9f3ff091c4094'
         '1774b8df43a408938653f503bb631e9c'
         'cb08008141a227d462c4f42aae9f0017'
         '61222b5e4cfc7a10e5d7f9508110693c'
         '7a511a1d15b38f7cbb3837fafd4d90b9'
         '40a4466850d29217f5ffd236219e8c39'
         '066d7e8f4eff226704b00d667dd8ebad'
         '6a31e875e5611784d4e85a2837cb06d9'
         '3e3e03877657217ada3437a0e0c4337c'
         '2a37f466dd9a1af095f09c366df995ad'
         '25fa78dde8fb4d7448709b88303d6f42'
         'dc7a993b74491e777d3c766dcfd62a18'
         '5b16a720e0448e91320c6932d0d4d00c'
         '48d825ada9bc7ae8ab2e663eadbffa01'
         '5f38621a69c99d21f68f6daf6468cdef'
         '02f0be176890b4c011234024c9368e5b'
         'cf2c6b3d8e05ae2682469acec8741e9e'
         'a90359a2555146a46fbb22d42385f15d'
         'f4ebc6847c33e5fc4cc401134903e9a7'
         'e8c08d696e38c370573ac6ea655dc755'
         'b14ac83087c219e180011e11d368dd00'
         '7593a865f8eac004675c6aaab8ad278c'
         '4c64ee499e62f70ca433bb31793dcf07'
         'c50606e5a28418078cedb21e757d6443'
         '7d8cf45c84b18353dee435d75d9fa12b'
         '1c094130dea7a474c0adbd370d53afa3'
         'ce118d387540053ade84fcca95168e70'
         '4f4ce1fe89f8b97cded51a892c7c02c9'
         '329dbc22c5dcb632023e6061e412a38a'
         '1ab0d3006b34501bc37667b9668db223'
         '2af6fea0620b74ccb4a5a598115e02b5'
         '4354afbcdfdfa15eb9c99311a1c6b20f'
         '2d87d5ea44600cb9a80b7fd2f5aa7f97'
         'a64d9049c532f95b0fa7d13c9982aeb0'
         'cafc16112223815e64d056164bd6662a'
         '1044adbecd90ad77318d28668a3c6b9f'
         'eaaacfeb8e2fcaaa026663b085676422'
         'ca8e0c49ebde2a4bf27dbc455af190bd'
         '08edae5a737f5bc559dd404668b7d342'
         '5df6c50e41456c94e2f12dc5b12d2375'
         'c31fdc13f4fb5e7f6f736937dfff807a'
         '9d22340af2e5fcb01be1168477738eb4'
         '42a6003623830a3572600fc5ef02ff04'
         '8d0c46cca117a4c1d27a42cb29cca37b'
         '465518a82e68ae43008cfd3ed6a17887'
         '5310ea3227196b19c348cfac5d775d01'
         '349e6c192622f6ca90358c51369131cf'
         'da49361a699599cfdf6523a5d1ccd536'
         '310517f8581dbedd67afe5ca1533465a')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
