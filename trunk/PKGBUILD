# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=5.2.1
pkgrel=1
_rcver=${pkgver}.2
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('70e2d15bfd6f4af69df8c15211558812'
         '101c881669510b9443dd3d651d04918e'
         '5b7b650d43463d44f9503e5075f7bc35'
         '5fd035f809ea37a5e3f09ed1cfc97d16'
         '4a458e9ba09926b57f0adf807c4db9ca'
         'e8e9eb2b8e2f7fc38f63076054eaee3a'
         '596ecbbff71801b6ea18fa82091a72bf'
         'fc1cbfe4bc2bbed30e17fca29b5c54a9'
         '0598fb602a2cfe8b3077bf7d6db36f1b'
         '31c0050f47140492cd7119fad11a2e49'
         '15bb677c175e4a1fb198f4914980213f'
         'cd50fd2c42ae8e33cccbec8a1bc3fc68'
         '8c2dcca801ec7c211677ccc805bd8a3b'
         'a7246e174af8109ec932fe7d13fb9872'
         'a2194df3f46ff11c50f96a3bf76ce1b3'
         '7d8b29b5fc255f79f4efc8394f150647'
         '0b5d5108cce9c9f28714fc020706988d'
         '17da20a0865ccc7794c0f7197b7e31cd'
         'bc3e1b12d37dfe95df6be105f955f065'
         '0759b6569330faa7069622181599815e'
         '4309b10e0084dbbc6dbeec07db20d8ad'
         '510b075fd8666b96977ec2eeaced9001'
         '197d313c50cd2848ef6eddcfb21ab662'
         '74172696ec634bbe55e9ff09929456ff'
         '09c3bf7adccb98dd9b70f6323d3b932b'
         '293f5fd4cc7bfa6ec74a9a91230a0b24'
         '1071892fc4644bf56182a6e37d8c1fca'
         '815786e934353e4fd8774a310f5e573b'
         'cb889a108f3ddabff035cc7660e34e44'
         '3183ceaa60146a72933de3732c6cf146'
         '549504c7c1c22d63d53115035364a91a'
         '65cce1a056bc96d4d8035012cb0f3e9b'
         '167824d70e5b9c9b3a4d040bc7a9a411'
         'b1dc6df4baabcaaf3212c08eca9bbdf3'
         '9383c3bb1890657a7dcc2b0f87ef5219'
         '9b83d3ea4176a085b4dbb88a7e8b414f'
         'f39b2f283927e693ea0977eecd80c8da'
         '80b1eb1168228ff55520a12f3007fc31'
         '8425d7c30fedbb3fc6c86f0ba2446f02'
         '208c935f668ec87f393d33bd7b9a4ccd'
         '3ebbf09a03e2aa941f11bdb314be2405'
         '3d5ce2494d35e3e343a07f5e6613d23d'
         '7b9ebe7319bb29322a4d153ea97d017f'
         '3b448b0e5ead321119ad0781af5974ec'
         '062e62fbe86f09ec88a4d8c9420630d4'
         '099be4e4ba79287663517509d5653360'
         'f6e6b76b94ac8ad5677899d4ef258dfd'
         '63b496ffd04ab6986a7474394e58c932'
         '771045eb373784ff91e15c92b057f81e'
         '99bb886f30aa770bc73b6cc98c3c9263'
         'd1ea203157ea88348c937bcac06c8c29'
         'b621fd6fdd0ca6724d31036b41ba9b9d'
         '23976dd48e4c0ab130f0272264607814'
         'ee3d31e49f92baa68bf2b19fbceb24ec'
         'ec9564eb56a7910c7335dc0d71a9d812'
         '9a7c75b65fce5bad2b3d0528c9b32cf3'
         '4454a8bb7ad1ab1380f434a6db844a8b'
         'ebeb8aa0f87c644952384d818b2c8ed6'
         'f07bcbc3b273ee678bb5a5f475fbf16a'
         '0aeeca6a3932fe48314ce93ea27003d7'
         'c21266bdcb34f1d1acef5e0e2f4a790e'
         'a6c55c00de97de3abd50df7a2b2bc186'
         '76bb8fc8e4575a8c009d94347e575f8a'
         '58eecbf6e88dd317283a0cdbbe8a474e'
         '64e2a805dd8bf4be2fc69a22e75b48c5'
         '7d2cbc885d627ee2fbe3996a83250086'
         '03fc25798c711f831c9c633bf99e950a'
         '480627c0b28330028e30989c2fa5a727'
         'bc186b652c9437e8462d66d7c2222d39'
         '388eb08dc6b67c0be8ca1b8f9546146a'
         '92a3992689a37228afd59996bd348dd5'
         '8ce54bcabc5ed204a6ffd665e3ac571f'
         '7acd3f7eee959780be5f4cd5001ebc87'
         'a0c1bf27dcdfafbc0af1548ac611ce3e'
         'fc0a3f4818cd83b4d67cea0c77d7d611'
         'f9e199dd939021c37f6b756e62bc41b3'
         'd425ff309e3ed93e394eb9b31752ec32'
         '22cc4e77e786d10b95badc69ff65a384'
         '53cfa9a01336cd157b10120da467b129'
         '89b247519c0b764a375c9917c1e47605'
         'bd363063cf84683a2051fea919ff1fd9'
         'de923678fcd52ba95e7a1bcf2128b806'
         '028217fdb5edfcf9300463e666be6112'
         'f7431cad3c66309bb6df0365c3918a37'
         'cb7f7211ff0f5be9c12468291aa45a2a'
         '85c8ae0baee2ea3f9160d2479b0a3f8a'
         'a07e27543cd1199ccd3dc9af8e31ac0a'
         '458474b0b92694dd4decaf67788ea2f9'
         '9a311cab62892be9ec7a86fae435e6a7'
         '7d2043dbfe8588b8f7a1c5416f4f01de'
         'a0b16194bcf5b7a07d5a15232dc07f1c'
         'cedbc7e7ddfc351438f93af4241e5b71'
         '01f71d8a955ecf5f45f50a16b6dca20a'
         'e8c1aef9727b71301aaae95297a2bbc8'
         '86e8dcc188f71cf8c3d37b7d63345aa2'
         '5f643680e6c1af6016c61459df5c0533'
         '8497490ded20c5fd7b4492b7195de067'
         '1941cbc477443db1a73610fde14ac899'
         '080c82e7a71e77011211046ae18bdfc2'
         '5098e0786761135ff6ade50ff2b1f079'
         'a9df233b15c31a33d49b642482035691'
         '2432030d353d7ae4a58b4948055984a3'
         '1b044320c64d6d30cf7a5c6706574fee'
         'e89b22c14103dc46a567827000d8ee05'
         'ec919b6400e73bf6c006b42e9d88269c'
         '03d6f3c735446eb493c96c9dd7d89d65'
         '24226a562a6b8afedcdb78194fc5163b'
         '930beb73cbbc7af1d1ed60d1463dd19a'
         'd0d831fb6a6cd885d5f7f318a8f2412a'
         'fb2232091574419b48e2ca1146e3aa76'
         'b1a32e593682b88d49a958e4aedbf25d'
         '729d4c561b70fc7b4e8648f16db630c1'
         '97acca925e9678eb19c7067419275626'
         '30ae0661b3f01bee894a522eb32a6e4a'
         '0c637a488aaafd0589364afec843db68'
         'b5c2c3875a287193032740efd0c04448'
         'ece65a72ed48399fd9b6e4e934c41fa1'
         '91d99f4c6bbf4fbe269e788477eaa9bd'
         'af5cbbd05d6d208d740254f8a4d73d43'
         '9c53eeb431b0d3a83de5d52e74e61c23'
         'f0769af86b192ad54a6cc70773e245d7'
         '24b78e9dbefe07aa9cf93a92149d7059'
         'f8e43f1bd9590e78f505b828c8942384'
         'c8fbec02212d09cba0c90acfc08d55e3'
         '2371cb6407129ba91e97b29eb8ecb14b'
         'e14ef1af0866651d6773460410ca3a86'
         'd42ba0437acd3fc44e3e45effc6b5a85'
         '55e36ebcdc80bc4655963f933e168ee8'
         '152276bbbe0063591bcaa152d30d3534'
         'f8a7ef7550f0c8dc20bebd687109e334'
         'b7d18d633c38f5beb7a173c2119dd434'
         '010d9f689d2d4cd10036b995ecaac800'
         '2dab8c2b9a068d073c07e0cc664b9548'
         'fc8e1c563e11b0e74faff73b80eb741d'
         '74489721cbc8b625b69bf893044c800b'
         '9579548b6b277f8ef0c80a9257c36890'
         '98fd2485b2df314c562e1fd8cb9f0fdb'
         'cb6953aee16f282137c0e697d94b02fb'
         'be9d5dee4706c7a1b22c452bf74c9f65'
         'e705c6e5ba6143b1c4b0cfd7997f38de'
         '6d7a330cefa2ab8af0c88214fc8840f5'
         'ab8b6959a6ca4322a48d4640a3147ead'
         'e97d6f04ce949917d238c94411acfc43'
         '40cfeae84e8e3dda64a32075aecd7809'
         '7a4dc3ebc0830faf931bdb0c6c7d9fe2'
         '11fde4a4215742cded4e87d08f1c57c9'
         '7e6f07cf54981de50cc7a760241fc164'
         'ae4b9c7984b5616a2f4e5adc9d91ca3b'
         'd6ba1548a7dcf8b4602ad3439573078b'
         '87bc57ef7d23d51584917e1b69361407'
         '17f934e23cccb161a59e3da6d1cf850b'
         '253302265ae95c1205d68ee7dd71ae59'
         '32dddcd6e7ed814a4ae6ab4b69d52aea'
         '0083e0c17d04282c0527453c03d8c6a5'
         '5427a94d6ff3174e70cb1b9f74b84605'
         '8aa9ad90c8f460cc535d152ae3e6a883'
         '644fb83ab1b26c13efd9c0e62c7169ec'
         '25ca0ab0e6f4cf061f794bf95b27ed60'
         '3e0e4f1118a9f5a6dfd5946089d73d6b'
         'e21c756351cc603cbef68590829b895a'
         'c9124f430c47ab2cb21f7e1f1a0398b8'
         'a3d4be36f97f8f7c3245ce01c94be405'
         '54c710b664afc3e4846f1da5364f314b'
         '47e2f46adf9d500f7b6f509c7ae71ee3'
         'e0af1f05e0d0fbce103776320d7c055b'
         '86a95b8d75f1e01a6e8bcd2b2c791442')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
