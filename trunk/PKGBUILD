# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=5.1.3
pkgrel=1
_rcver=${pkgver}.2
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('359a8b31d6cde5ea515ffea517fee081'
         '5b19a6c6314af4563ca566fca679d25b'
         'bdfcb1d34961f9c7dff8c87aef776ea8'
         'cb27a74ca83b989da900d91c3177b4fe'
         'aaaceea90f8da4ce1e84d691b2f6ad3c'
         'cdca3f555e33e101c044dac506fa7148'
         '24d24e3712e28340e568b758c2c6b75b'
         'f87a5fbf57734ca6a68b28453b8bc9a1'
         'a08ddf7f2d17a933738294316ab9086e'
         '07899a039d96b0a66e49873e049fb007'
         '927edc5bd915366391c525c98198740c'
         'c338aff02c5095c7d8ded9b7888d42c3'
         '2761664d70f9597b0be992e48e376878'
         'dac8ddab5b3cc1eea509449053a6e6b6'
         '3d10e619a13be7a8840ef7e7aacadcd3'
         'b9b895bd829acdd8e87d21e73c00a41c'
         '2e9fb8e89757cef1e9c0d6a3dddaea08'
         'b2704853728604f68ba6ae46f62fdd0f'
         '5381e3cd9de32b9403dea839e27d1223'
         '52f85912bafb4c6969b47472cefa5791'
         '0558eef27a35a8a138b47c50351000f5'
         'fed52dd0c46a69fb4115d5017b976a4c'
         'a6a042688fa1fc5dceeb80fd69166ab8'
         '85dab4e4bb12c016387d10219bb1d1d2'
         '39d04b7d9862cbca3cb15ba867500780'
         '9c8f8c85c51dcdb8d888492222d550d6'
         '8e5691d90fce008dcff2b10c02b4dfe9'
         'f320c06ccb28ed1c1a84e127a1b42de3'
         'd28651eb7785a3b847c01671d7f3a9ce'
         '2e735ea66b5396dd1747f6b31bab6a08'
         'd882b60464344cb40a8bc92de279faad'
         'cb365aadf0fd21f8682836e8aad6ee8a'
         'c078db0313188fbdac4e022c5155d0fe'
         '402804d08333febc1042abd3b187b183'
         '36e82a6deb10f678db9c20e7c7690c55'
         'e2cf8c75f0889da4869bb3ad688e27f0'
         '209bb05c5ccbe3a5bde26b834674a568'
         '6b09249adf203c085987e962955b519a'
         '4cc6de8b33cee0f0fd4a4cefe226797d'
         '7df22b131dbeb01b6b831c6873788143'
         '16e3b9dc787b9b041cf746adbcfb2874'
         '2db47f14a2aecd725a124687e9bd8b12'
         '51375b05eb3f7a327d2e5ab734e29d8b'
         '51c98ce27730870a96dd1ae88f4a1724'
         '7d7114ba99d5b62b89065f65c185c233'
         '949627ecea2036c69e28ac6e2fa372ba'
         'b88b9f863ba715741a4b41bd42c9faaf'
         '4375f3ff2f8c19e8dadecf3b4a41661f'
         '50b6e06c0fa78a7a6352a4d41b172690'
         '7aa8892dc20f562d007b80623ec407a2'
         '81f7f1f2654329abd5ab4926b4327c9c'
         '9987e83548aed5cf5338dbc5997763d7'
         '5d75552fbcc9f5aa012edcc3beaeea0a'
         '762d486f5407fc81501c58e7f5dc404f'
         '1398da384fca4f754a66bf870e7759d3'
         '086d974d378853a37f4f411d08a81e4b'
         '35f389d51aaf42a1eb094560a7b6f115'
         '8ca35d7c242ebdd721a72743008de4f6'
         'f17f96a945326b92050874c6d5b2bc26'
         'dc7484be9d1357ea91520f50b19afb72'
         'ffdcd78a676938faa101f652489fc898'
         'd22d7d0827d0cc12d29fd210b7c976ce'
         '4886306c24a998d9743f3efc64c3274c'
         '96cd664e6885582c3a0840c84e86f535'
         'b0a95a3bc5ff66cff54129ccb13ad0f3'
         'ac182eb814c079853fe7f19d8dd71274'
         '2c85e2a12c8f6bc6117f2cf059a8d202'
         '65a24a69535fbfd75a4507225622fc80'
         '6bfdbca83f794841d49178b30725c54f'
         '876e6672ae8987190eeb27252d335899'
         '69474d7adbf2b6f78af3ec2709d11007'
         '878f66b93f8fea98dd6a2c275c641959'
         '4b28ae5d8c68928251d65814d267a850'
         '14c7dc9254e25ffa51fbe3c2296bbcfb'
         '55515959312c108116cf1a4a46c52545'
         '066a18cec7715bded11bf3452bd4647b'
         '32064da899512ae190ddae74432b033a'
         '119ba10bdb025f0056a00d752053358a'
         'ff77baf687afc0b68ce6bcdc2b459cba'
         '03ab91176cd6fb1c4d9a6d553390a41f'
         '24e6faf405b64e8f9668d056beceacb5'
         '563265403d71e4a71b5f67962003aa5f'
         'dd3f7901ffcae5e9cfce97dc917dfb2a'
         '3241734771757b2b9adcdf5befd79fca'
         '79e11c66a1f8b00164b9f0ccdbee24bb'
         '0084e44e00abbc74616f57435a01ba90'
         'c8a4206d32fca97b1cc3ce43e6a53e8b'
         'd275c737b66d2123f77591e3ec66324c'
         '4b50df326387a972f86aa58990df149e'
         '4b50effa985c10d24e8228af780ba3aa'
         '9f726f456236785a5f6647cd7fa57742'
         '791b1592291addce785e0dd1925626be'
         'f4e6f3c348ee55ac5b7d436473d171bd'
         '3378135c292020a197d6eae5cd323616'
         'af7a6e35f88a3fb95024cda6feefc0a0'
         '276ff9a52a6c025f6b0c984cde26d33f'
         '8648a394764a12c4173e253d3fbd5ab9'
         '650f95de70e289c64b86024229afce18'
         '0b1c8234ceeac40741f6e24e44a01da3'
         'd156a4b6ed9e957bee4399903962eb1e'
         '445a669bb1359bf6bcb2054aae6dd4bf'
         '01bf9edcb10037fe448a18945b07d42f'
         'd79548111c1b10990da30d044d4ce9e3'
         '191f661ff23ebc3ad39df8251db62853'
         '0b8972115ece07a472511aac0d5f13e0'
         'e6539a3ff11aaa984f9a80d1091a5d8e'
         'd81c102cf07879c9ee01627f8227c099'
         '85c85a53a6d5f7dcc6eea7adae7da61e'
         '3093427475d0ab16241e60e89554966e'
         'da5c4b156c4f50c5e7549bd47769df73'
         '8865e016f296cc3337bb4bb9408470f2'
         '5080f9a619f981ee3334967ac909ff73'
         '23c3c2c763769c4aae5b9ee41751cc5d'
         'ed3c74654298fab83700d0abe2e113c4'
         'b1a46399309407937ba8d42fc25b2a7b'
         'f764cc142733424dd5b5fd5823e7b0c9'
         '506761cdfe1275e641793679e4d0f675'
         '6c42e3b7be44e3dfa7e9493b6e56ea9f'
         'e98cbc7e7251c5d98592e00587900f23'
         'd765a200d43c53a8001645e1a3177429'
         '3cc044e5ad2ffb9e907fb4c20578a80a'
         'f773bccaebe4fd0fa856dbeee4c1439a'
         '2beb3381afb6ff0fdcc89f3bd6c5f19e'
         '6438aa814d0ad8cccc6a9f828f14f87d'
         '9304944438f4f2c2e4171dbbdf72d6bd'
         '75a512ea614a52ce0f7ff808d10d2827'
         '75c18de0ae5623eb36a9f56f88509e4c'
         '703956ae6826590061063fefc59eb976'
         '990cad5d08d5a39487f487cfffa6caef'
         'f439f4bc43ae7b1db17000c61c146cf2'
         'b04867e1a70f629ce72051bffca84373'
         '50e144c881d0eb5ee139c299562c194f'
         '81a85be286bfd83bfa0c36b76df7a5c4'
         '5aedf8aefa5528a8e8154804dcdcb1db'
         '099689d3b76daaf293306947e69e9078'
         '706b62f8e4be34c4bff4e0c2ed8b69c6'
         '186ee2f6756f7e565f269d2f4e24d4b7'
         '1f3271e17b2ec7db38b4da592e08ac5d'
         '13360c30cdd3cc39d09ed4c210167046'
         '0f47b189ce7b652836e906be5aa678ab'
         'b4b1cfc9024107ab6633d4e8d97c6795'
         'd7f3cbcd37525f28270a0dc320dc202f'
         '475c33e15214e4df5061f3a016860aa9'
         '8fc90d2096f91021dee91e1c5c65129f'
         '2f19cbb2ddb3fc4050eb9c71e166bd58'
         '49d67e58d0c11db7bc35d1f370376415'
         '5f8c2a1feb6a6f9741cb612064c81ae2'
         '316adf22c9e24dd5b581cd504ea43308'
         '0083f8a7d0e29c66a71dcda0b3593d68'
         '79b032a4e0357cc4f247eea614916eea'
         'ba117e0f1c977f7745a23d1cb757d540'
         '8550ffd8b08006821844fa77ead07b07'
         '8ee01ba0982a7273beb0053dbc73b63c'
         '9c50f0bb2e2a29308c8ce9e994d51b62'
         '232190a1dcd1999ab99be6d84d5c84c4'
         '67653d8d85216338b8a1c1bbb37a84fc'
         'fd8a6746caccbe4aafffe7dd6a302b35'
         '01b804d796c3dd123a729b92abd4a2e3'
         'd1e60f7bba789f668582b81575fd0e73'
         '4b33165bf1592c00ca309248ec351de6'
         'b386f835559dae28c74d1bc6e4c0e495'
         'ad50c00a7811eb1203357a74ebc27739'
         '613eb50c38b6f0d3cd375773d1e9c800'
         'a9b7a4b8e071d678771d9c71bd290184'
         'd879b062d661fe6597961c29129c5bc3'
         '108bafd82fd2416952251304c9c970c4')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
