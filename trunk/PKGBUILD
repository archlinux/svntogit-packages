# Maintainer: David Runge <dvzrv@archlinux.org>
# Contributor: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: Aaron Griffin <aaron@archlinux.org>
# Original TU: Jeff Mickey <j@codemac.net>
# Contributor: ciccio.a

pkgname=squashfs-tools
pkgver=4.6
pkgrel=1
pkgdesc='Tools for squashfs, a highly compressed read-only filesystem for Linux'
arch=(x86_64)
url='https://github.com/plougher/squashfs-tools'
license=(GPL2)
depends=('glibc' 'gcc-libs' 'lz4' 'lzo' 'xz' 'zlib' 'zstd')
makedepends=(help2man)
source=("${pkgname}-${pkgver}.tar.gz::https://github.com/plougher/${pkgname}/archive/refs/tags/${pkgver}.tar.gz")
sha512sums=('3a9effb9a5cf46fbb9f393e58bd938874dc4121828b77c67d659117ee84643917998a8503d629f46f1eff1826f6d7ae59ac2d803a5cdc3cfb1006ef2b3abf8c8')
b2sums=('1c04a8f6149863667151e76b3c1ecfdd5e9a181b305bea694af1d4968ac361114c9e926b351dcee2647796a21bc8cfc55b3d95f020ad88c3388007460de26053')

build() {
  local _params=(
    GZIP_SUPPORT=1
    LZ4_SUPPORT=1
    LZMA_XZ_SUPPORT=1
    LZO_SUPPORT=1
    XATTR_SUPPORT=1
    XZ_SUPPORT=1
    ZSTD_SUPPORT=1
  )
  make "${_params[@]}" -C "${pkgname}-${pkgver}/${pkgname}"
}

package() {
  make \
    -C "${pkgname}-${pkgver}/${pkgname}" \
    INSTALL_PREFIX="${pkgdir}/usr" \
    INSTALL_MANPAGES_DIR='$(INSTALL_PREFIX)/share/man/man1' \
    install
  install -vD -m 0644 \
    -t "${pkgdir}/usr/share/doc/${pkgname}/" \
    "${pkgname}-${pkgver}"/{ACTIONS-README,CHANGES,README-"${pkgver}",USAGE*-"${pkgver}"}
}
