# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=4.4.1
pkgrel=1
_rcver=${pkgver}.2
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('b938c4ab582c01bd0424943cf030ab33'
         '61b2205c655b1c07f59924dc532008e6'
         '900a5747d0ee29c0f75c8de7fab091af'
         'aaf562d1193b90f68e879f313bfbe9b8'
         'a5c700f719e27cd850ea676f43259a27'
         '718702bcbf34ab6b1cb9014fd6056f57'
         '023440406807a2e41b46bc3d202491dd'
         '6ec62e43397ed4dfc8d98d4de831d21e'
         'bf90f97a806b82655e2f73e3d7be2df3'
         'bbc875a7ac7dad2032b7869d7d382caf'
         'c633d9f9e7dd77a90a4de4df7355acb2'
         '54db04f6338ee1c4dafd9bba2bdef848'
         'e6715f388aee103d69ae1b680f29b9c1'
         '214e3e6eb6587c4f8882ab27492e98f8'
         '5b705146f6b8d8c58a6aa719fbe9eb5e'
         'f42c2650f8f7e4e1bb2cbbc0ef8226f8'
         '39537551aa9e64f99613498be741f402'
         'e7b81813ee34df6b8835eabe39175bca'
         'e097bc29d1e50203713c4de5f96863ac'
         'e6c756d47e2561703099d609780c2b16'
         'aa48da3c5932526760012267ad87848a'
         '76ca95ac960c8cbb6f89bfbdda8c7705'
         '332186f4d99b09b9d688b25e3328b070'
         '0750c4a75e10326c480930999d98c121'
         '29b2e40977f596919ce595e5a2ad7424'
         'd4835dffa0791e7c5566a946f58730b5'
         '6067ef181da90bc6bff5d457f6e648d2'
         'fb2f0fa84318f6c86eccdc4147e79894'
         '1c75ab08f038b5bc59ebb269d6e4110f'
         '49ac06f35b0552e0579779bc13c61a80'
         '3cf11745472fcbf3948fee269f3f8ef3'
         '8b5860dec93cb5b4773876929d8bf955'
         'da1c5d565278c935aede4ee7e2a8401a'
         '6a6855c437e2483605970871a07ef073'
         'a005866591eeb8bcc5240a897e436e7e'
         'e7e61d7c91ce69ee14b4efbdc9da28dc'
         '6f262f5e6b59130431cfe2e755503749'
         '267e393ea3d35f5d93cd169e716495cf'
         '5c5471604b691d24cc2b789722c47928'
         '4bd81219eb86714b7c2908a9be19b0d3'
         'a73c526bb5320888a72d670702034ca0'
         '1bc9c59f683a12d790612d3343992cac'
         '58475c36492c7688ecf73afbaf939657'
         '27d11dc80b2f6d151cb8079ecb9d35ef'
         'a64bf8c524bcc0abe6ba856efa87fdc0'
         '3167ca321e4dcdb0f863acabca5e3f4f'
         '18429bb4eb58b8c552b01c68db5381ba'
         'da1262c9e89d5598e5d950c556b9f33f'
         'eec6b005af9bf46aaaa67a28aedddaf2'
         '19f78655db24213bfdc4e9550c7bd844'
         'c21bb59766d4c1f3053fe207edf7f539'
         '1bc67585b63310a11a8c6328dbdba8c7'
         '70a0b4f5df554546ccbf445f96ecd8f1'
         '963eda033848573550311ba57b29a41e'
         '8215d6dd19a6b74e357a6461e81a197a'
         'db79baca5222c324231d99e538efb59e'
         '815a9ad4ed2a792e6496cc83a098e417'
         'e83c4a5c0b4aef4edd85448d70c90602'
         'a6f6f8d6fe871b74f97dda9f71f037db'
         '3c9d9287a6a8cd74f7657cea65ad9ce8'
         '4f8ac45b65d169d37bb703167a71111d'
         'aa8af760c8751ff666143c002b43f0aa'
         '58d71c13464f79ddbca2fe15f93f63c0'
         '433583fec22d273e82ea815861e7bee7'
         'e5291322b3bb14b84ee335a90dbbe4fd'
         'da099e059af2f05bc0300fb0013926b5'
         'eeb77cc977383325c1a8f8f8dda8d49c'
         '3ee07f504428e0a8716d9d373b45a87b'
         'b4d0257bffaaad6edd7dedd27d406ad6'
         '85f393e86d181fae71276c35605b8585'
         'e37323476f74c989c866d11cfd25b4fd'
         'ecbfc300b29eeb5c2d206cf9c6bd5cf9'
         'a0d3a39560c2bc484973668334622089'
         '360723d1b93ae2e111eaf9be16a43b11'
         '458a358397eccaa9b0903092f0663626'
         '020b0045ab408feebc47b6cb5e11c9ce'
         'bb39eb44e68a41dbadfdc01297dd24fc'
         '18ffd32133e5a1f15a01288b52fd49ce'
         'c750cd4c11e4b7ae07dfb075535981d1'
         '92667bf397066a799538e8a327eb7812'
         '7c44fe24669d9687be74e07eb85176ed'
         'e7f0e51f93bb2a6a6b259a5df90eefaa'
         '04da2acf0979b1417d80fb8b8dd4d26e'
         'e740b3f6a9384f41790ef951f10b247e'
         'c0c2f6d4eb49ccac10965455b1a71c99'
         '7fd509e901de0c84e4e8b18c0a1e5d7b'
         'b75cbafba4d57956a46e69da358d8e3d'
         '0946382ae753274352b0efeafd3eeb21'
         '53ada671e4d8f32ca2ef2d341003a5c8'
         'e3db335993bd2d217a36a5d72004a97a'
         '8a057b8e4744ee61620c1291f1a61125'
         '4761b4d7be673d857c1d703522a7a851'
         '715764f0dd20a0b002f978abe76a1b45'
         'b27ca35d8402796626442e99651137a9'
         'e1dbc33da41c0c886f43e535104f08fe'
         '02d56958178251166116293dadf7cc37'
         '28b094d948594dfca474a2f787cee4e7'
         '91e6efc0c37c1f8670d2ea45ff3e1d89'
         '97fdecc370444c6216da87c0a6649ebb'
         'c171a287d96687162c5be2421201a47a'
         'f90bb5e082ed7632af7452e829b898c1'
         '40f3f5da88e3805f9741631c15ac46e8'
         '89a22b3484ecfa0792512a433f72afa4'
         '32dcd3268982c47f528179cdbe39a186'
         '8498de9910cefc8027515bb5ff5e31c4'
         'd4046bf3f0f03d300450917a570c1dda'
         '2baa72c82aade8119ea8212b617001c1'
         'f87326c7692ba0840bc5e2f7de88624f'
         '1e0cdc19b7a24b345bbf97bc070f0fc0'
         '074d13d7e96dc0b6c420750359f2daa1'
         'b46d1bcc17819067d734466cbe333f2d'
         '305e6e1684e7ce34cf87f16c5723b925'
         'cbcdda951bf59717dc924b8a48ce4aec'
         '96f0330e74cd4b9acf3f096edbbcad95'
         '2399386ab9aca79be62748841cc18bc5'
         '32cfd6bf36721aa08c81a44381b558d8'
         'b2abe4a5342c55356b37d8314801d945'
         'b16ba200ca5d0b8b42c9f6e7d16ac7d1'
         'bc44166f12e5afffe31dcd0b99c9e82a'
         'ae7e0bb6ffe3278d35a674f149ae1900'
         '97f184524c810b30d1c8c384ea7baace'
         '86c6182c57a293a06b2966c902a0cb79'
         'eb11ad6597f8d2fa0a31371cbbbaa34c'
         'c8165a5ce973df3d5fa6e2eee6928aca'
         'b92448fc01218e62844f338386f29f79'
         '79529c4ab42af4a2526d781362f09325'
         '7b4aaf0b2fe3c9a44a9aa5cbf136d31c'
         '1a0ad71ec37eda9293ee71d91c0ca3b7'
         'fcc9afaa07454e15d71f870bee12b195'
         '821f5c4672fe712cddaa52c00bb5a26d'
         '45768161f157e5b470d8eabe27db3463'
         'e4a7a3a96f84f10ac556145f7d8a4e3a'
         '625a42ce6a21e78060347ca273354a7b'
         '5b6d1f211f48b052e08416508a5a8ab1'
         '25ea7a8e5cc6db0b190374691b92f6ed'
         '2e74dd3f05d39d302eeb582002d25e04'
         '31e5e17f0d324cfbc7596ce4d4bc51f4'
         'eed5e39bef08af6b5cbd584c179528cb'
         '7121fdbf9b5c45dafd27f7df84b0220a'
         'a40f2125ade5be89ad729e7d2db997cc'
         '5dd42c23952b589d6e4a713d51c752cb'
         '33a339e39e619c1da7ab9cc392f045a7'
         'f5bfb1ae2cd6e2c918ae60241da151dd'
         '87342c24bdca864e7ccd50b1229dca47'
         '4b2e61074a001c5d146a5623f7d81402'
         'ad1f21158e2266e11a883ce6e95bdfde'
         'ac6ac42ad4bd5e253223c92fc08c1ac4'
         '108e359a2e2085fa19f639ed2d17236e'
         '9e0403bcefc80d2e40441da636feb84a'
         '62ce5724d68081b393cff81bbf82cb48'
         'b9a73d76795d2a9b7b79c89529d3971d'
         'e0f22496383ed0fa8b8d148f68298635'
         'a9d0d3a3ee1d54859ecb5598f0bda97b'
         '560e7a047f8d0b032ebe7a00d2ef0b12'
         '098f27064b650238462146e72048106b'
         '907c9afd7ac33e283415b42799527be5'
         'fd4aaeb4d6776d0005de360f10c5389b'
         '4b517b9e5a46fab5b723fe29fc95ba88'
         '8c9a2e8227a260840ca3bafff85a828e'
         'cb50c9e595e390f0c0e07f41c80f75ae'
         '29e125c845826fd56b25c725ac1c3f92'
         '7b210a891af55116d91596a94ffc8e87'
         '45b8b07547419ff62e07c3e5c55fd613'
         'ffb12fe236f2d9edefcc7655326745c6'
         '9577d7b5fb8c8a7fcc22bd606a043926'
         '39a5c0423ea6e3fc5fd084dc2d7e5e64')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
