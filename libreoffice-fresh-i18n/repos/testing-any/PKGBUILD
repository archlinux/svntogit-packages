# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=4.4.0
pkgrel=1
_rcver=${pkgver}.3
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('cefbe7723c66ea72c5f40b3d97ac6e4b'
         '60a5335c2a4b1a85a95fff7824e021de'
         '080c11e50cbab1611c229e7f3af77dad'
         'e79d8c4948b246b11354adf3ffbab20a'
         '32007c029e7edaa2dcbb5ad17b05cd7f'
         '0cfed670deae954314ad4b658c139450'
         'fe5b3182ada0e1d9c405c90cc7f5a903'
         'b165f31607355b7d845b5336db1057c9'
         'c2fdb1e42e3e66fd276a52f12a55c842'
         '242d280b6baec6844cc3177f193db78b'
         'b25621c7233fb745db3bc7588127e6f4'
         '989dc0a3ea83ea845235b66ced2626c9'
         '509db0255a393bb804d21b27b3d798c3'
         '17d64416dad5c2f87762b4cde43efff9'
         'cc9c7da92e332c94ac29b3d888119c9c'
         'df45c54218227d937d7244340bd4ba9e'
         '702379df71af38c041817f7dd25f0c81'
         '5a0b25d26042a1f99a65f1f5a581d9e2'
         '1efe757b703211ce30558ee62610e3b3'
         'b2795bea07063cedf2bcf1f5feac8c7b'
         '8df5bf62ad19c9ddb95ed2ef602b9d41'
         '3c7a3aa5ad4fbfb9b93b800563975a62'
         'e74b6522ed3ea1ef801cf15166f96012'
         '85099a3d978f8b56962ae71a291f0a8e'
         '37cfd3891c2645387ce001a48e38f27f'
         '4fb1a1e66751b46628fe1da4f950bfc1'
         '18c773e4667a68ea232e459241425f03'
         'b462ee4e4f57acef0ab0c92e80015190'
         'c7851b03b4424d3ca46813a828f4d890'
         'dc7e299f45de34102adf8640545323f6'
         'e44b9e54460f846fe2011b697963d387'
         'a2c6837c91c87aa88fcca37f3c7d1a82'
         '6f4fdcb417e0329f43fa11555dc427a9'
         'e4cbfdf116361bffcff972a5e3b8b612'
         '9012ed5064a33872e25e403616d884fd'
         'c79a52a2b48bc8ba43c6ad9ca4cbe2ba'
         'c6604f9fbcbf0e33757714380efd6707'
         '7d1cc4ff4bcfffabce6614f2ba2eb038'
         'a48a86e53d363489dd478354da7c6f07'
         '161d313b080c2708a4b605d5a39b9b14'
         '30481ec0dbbe6ccb9ff14bc7b6cb120d'
         'e86a9f62fc86ebc2d1c86a9d6cf11b02'
         'd8bbd6c554cc37359936a1742f687406'
         '0c87f5fd508bc415a8e98fade55f75f2'
         'ffc81af04ed1cf7dd05c51b2044dad43'
         '10757e24df4dff5daa31aa1b784dada3'
         '0d6bbbead0719cff0e2755086a2520e3'
         'cfbac67bb50a545424bb73d32338568c'
         'e9ef4a037ccb20cff028cacdbe2e0a5b'
         '01c6af4ae339cc6c966f4e7a00da9d72'
         'b6a303bef8e4b631a08530c6f0501d34'
         '3cefad0ddbe2d3c78989a17f1cb259de'
         'f25dec65b7846a0835a3179dfffe9456'
         'ddb82430384ba932eb2004cf2d730f32'
         '22ab0349603c58c2f2d6a97c090fc53b'
         '661376e288a0cb1e9a8bc35e5cf4ab34'
         'd869ec0cd903bf5bb0659a8e4ad06021'
         '17402d60ecc16d2e05632e91478ba0b5'
         '02d3d3f7c5b319dad0fcb48c63f277de'
         'a054fe9f88aa9a19a5eb3153d046da83'
         'bd79b0e2d4435466154dcaac7af78ede'
         '1bde34e4815a3b745acc21bd942a8690'
         'b149d5883407ebd6274ff7a43a390fbe'
         '484d1c71d11250df93681357497b6f9f'
         '6f6f6287587ee76a5b3b108e3463e562'
         'eaeb92ecedc8eec5816efa9573ade467'
         '8f4144a3fc5b1910dfd1e2874d832107'
         'c141e1211f62ac1dc3d63a0a8d0c2834'
         'e3342d23a4316c7c06882df488d6efaa'
         'dd0b147385571928d41afbe18566d2a5'
         'd5140b364cafe6ba4ba3caf2a1953c0f'
         '13bcf1758440efe3bc5e0dfcc4640a3d'
         'd3913851aacce84b1f58dfab89623024'
         '574ed915ae6c144f919e0e4f3a0dd4d5'
         '08b1b082e91d30f59460f3c513db3174'
         'ae650ad2b936861a3eeaeaf5a5027096'
         '1fd7cf240df40f1f6318c3e2fd4b33e5'
         'fcae12b3d5689837de6b77a6fc66dc20'
         'd9ebb6077f7c749ac3ef7bf7847bc00f'
         '201b54ee0f2f7e5ea6920a4763435118'
         'f7320436382b0c744d4e547b3b80c18f'
         '45d25ebfdbf5a00c9217911429a15590'
         'c5af42b0e6d3bd060228d4186c85fc77'
         '4e9e5e12bb876668a2d91cf5af358bfe'
         '950ec4870841a4c86126306e94225acf'
         '1915861e568c85ac5fc04c36559603e5'
         '1f216439eb87a2ee2fd3df5b6ebf001d'
         'f8443979dc600b1fcd3ef9f32941930f'
         'f569bd888a8d890f204d40f8079d0a4b'
         '68bd0b5f36ee240a8e9d60c102483172'
         'c1600db5ee890367d22b9952279b7949'
         '75a50c4fad69c8ba311b99a73ff947bd'
         '15115c7a99be27667deb56cd173f2451'
         'df8637a8b4f84419c506c744979eec95'
         '8f306578e026a3862c845fdc620bfffa'
         '51245b5d69776151abd412b04a13a99c'
         '8e3cb5f56d6d41b37ae30f879a28e46e'
         'b79447b0a4e2aaa7a8547eb3d48a1d4a'
         '9d751e53876c40ae1a2e0e893526a02c'
         '0e54f25606706987623e9426be9a14a1'
         'f28bdbefed25edede4321554c90ded1f'
         '83993f765f2869ab17feea276090423a'
         '950d5955a769be84790141ece2fe9a12'
         '2450d7bbdc45af8a71af5c56237b26a2'
         'b3ee7f688684c2eafc0890477bd81332'
         'fd02c9abead623548f5898e287cf71df'
         '408a7a4d59f6451d366211144b60017c'
         '68f6eddea2b1483963b34aa5e6dc48da'
         'a79969021f1719e76d070b4d1b42fb0d'
         'bc17ea3077b2a6f2a0c5807c66a953a2'
         'f95b7b9b3017533c75931a3a22ffabcc'
         '9f9352e0fcf82a92500d0c7705ec2ce8'
         'aa11a35e5478e1e59560b4beb4c204bc'
         '19f8fe2c682caaeb39bbf2b6edca6aea'
         '73f60f4a294915ab71a1ec76b4b4f65f'
         '650bdddf367871b368d176900aa162d9'
         '19da8588ce524923efbc68f761832596'
         'a282746200a03c56af0f997e0e85cd9d'
         '60c6100b46a5901de607b9353db68776'
         'ba4b7d97a54bee4343ef7bcaf95ae904'
         'a9427926c1d36e88f5721833abdc1239'
         'b6726bad953100a4708c3eaae9bc8225'
         '8ca1cc7b6bc752f787d6b346af42f0a5'
         'd91522fcfe9b7b19ec2c619a2a0d40c3'
         'fc06a5250e60ff0b780262101c4e2165'
         '385040329b228684caf9c5d7bd9d0e76'
         'bd823766add2004d778a7c03238ddbbc'
         'aa6484e4ab75ae03651eabb58e50de88'
         '07cb519901fe5e27fb08d8f82040b87b'
         '11b91bf183c4595f93812e1351d713a1'
         '57d51d5667632f4d740c55c18d449082'
         '28ee32066f63bd71dc3c13212cc02a97'
         'e1025e7ab660345f4bfb0e06a4ca08e2'
         'e24453c482510c76dab86a2671fc8eba'
         '11de8416b4ae34a8c0340ab475c02711'
         '78f6766661d409b60925f97bcde97bcb'
         '8b3f08adf79584918efe4fc5cdf8add0'
         '227dbb8b2acb35056bb88e9edbcd69eb'
         'cfa5659aedf2f573e77e478c23af45cf'
         '35bbd7259d82a3dd7d61283efe6e491e'
         '173398e30e52d820f37ed0bbdd0f2b31'
         'db1cdbeb1f8fa6291452d74f237a9d8f'
         '6f11408310de456dc7aaeed6150c147d'
         '41fa6e814e64d57817552442a66f1776'
         '242891532dfd6964c5b7807130384521'
         '0627bd2ea864cf9952e0992c9ae98930'
         'a191449d13e88f8eeed521d9d5c5e523'
         'e40a1a0341d21cdcd6cb1e4b2ef9135d'
         '048b02f9aade6a346125943b0b317761'
         '5c0d62f251e2e3170bcfb11ef8d88b0a'
         '6991d6ca08c8a36aec459ef5ad33b64f'
         '14e2c96533de5fcdc0b1000edfc3fbe0'
         '4b84a7ea1afcb15c8b6a6cccea93823a'
         '3bc464cc491002e2b525a103c0a07dcc'
         '22561ca357f22d7990dfe9143f08328e'
         '023fe1cc8ea8a82ec60094b6d55350d6'
         'c9105d414a0e30ea5c1374f9b92c7e60'
         'c52ad975ff053c26263b72652d8fb78d'
         '4c1b60505674b63030402722ae6e3808'
         'd4f5bc0bd7ae092cd083155b4d8fe48c'
         'c144b3de698014ef6a2aa8c695729c00'
         'fd484eac3f8fb2943dd85a698c0ea121'
         '4f78e37c1a778a66e0c641ca53da3797'
         'e557f84db985d9799e5ba36019f271a6'
         '1ba8cc2fdf688e86ffd88aed3f492d87'
         '2479c9707940cf783dfa1673dc075b89')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
