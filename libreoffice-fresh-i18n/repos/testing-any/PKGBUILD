# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=5.2.2
pkgrel=1
_rcver=${pkgver}.2
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('c4d7ff9821e0b64932c74dd56a1d1235'
         '9c73f30023755cb85943c035f2a2b998'
         'b66b67d9cb0e4f31978e3692146b527d'
         'e8162c959fed4306080c3d6c635ea29d'
         'ccc543a7c0f8a6b898a081a617819e83'
         '45bdddf9782dce4fcc238cd91881f45b'
         'bdc68b80198e79f6dd17fa7f823f3dbd'
         '8818f8c36630506ff373151b7d019e2f'
         'bb85c67579a4eddb42db777f691f09f8'
         '16c3529726c89268b1fbfa799a5f6bbe'
         'abbce2a30f71830a1a9876f135d02beb'
         '1f7183faf4375bd24d33714fd853186e'
         '6f5df9e0e850e4487776a252c8db2268'
         'cb4d2de7700c7ce318fcef8b5485a569'
         '1114be182ef05642f93bf2eda5a152c3'
         '8349593dc2c21ecbba83458272459768'
         '0ec1f33f56d8501c1be7266ba90dd627'
         '2dcae0bc2efac42b314193dc665a0a5c'
         '7000bcc65dae626922b714fcb63524c5'
         '1cb28b74d0c2e5603b9e243a60f2e1a9'
         'd18ceff35cc25f162459634242edb5df'
         'db5f88eb421332d0a1be18970e84b015'
         'ff288ce1aa01b8ff1b559ba9578cadd5'
         '014f98eb8e56713e0ba50a6e1ed0bfe8'
         'ac6739d087f6c46dd7c42e5f3b70dea5'
         'e4e69b0c4fc3b13bf67b046f74523407'
         '4c0c71b628c659f086f66d2844d33c53'
         'acff1aa296f922bb59fa0a1b61afa077'
         '746b934e57b1a918d376f065b10c72a6'
         '433bfe3397b4a6f0c41894fd1d49f648'
         '6eb072d49063c80fa2c9fecb2eade598'
         '51330350fdbfe1593e3e17e09828b7d7'
         '24fee141e46e5fa9ae1e7501009d270f'
         'e00d132848586d04d9273df22f7449df'
         '65086f86689e74a74cb1286ec499869e'
         '18458f17f82d64e020a3d6453bcb39bf'
         '592d8b8b0b114574c924f62dcc6801c0'
         '1b9b0bad7392a6d62ef79d32ad05157b'
         '5df864f4580e9a57f658e72a800e4f6d'
         '8d8baf6939cda25ef4e448108296c899'
         'd76ad18d4932394f6ab0946023bfa584'
         '31909058047d78db219c0226d9ac3652'
         'd3b296953fa1bf67f7b34cbaddc3c549'
         'ee85f1d241d0228249bd84562c04b34f'
         '2dc9630efe5c9e58629ded2df7773e62'
         'c66c114f9f38464c8b90bb02a75ac4e7'
         'fabeb9d488c53b43d91f2b794db90405'
         '32d088e05a9ac2868b8b3763e826ad00'
         '40715d10aeb6665e9c1858cb32cbea22'
         'f00b5074146c903a321c99ddb0ecbd36'
         '638f0502ed9a658578d7b6678edd41da'
         '2066a0b26dc6be48704100e2e0b26b6f'
         'e944a13676d75035c78f704f154e8d0d'
         '0011533a852874e0b6cbdfe15476f321'
         '27025bd3d025fd9db837e2a88762d4ba'
         '13ec0aecf40dead0e6575db37c4ffd06'
         '410e41dd4ace54a392bf1603c94549fe'
         '3fa56fd6e2f367fb0c4786b2d1c5df40'
         'f40cb6a29f0263d8ac5175b8ea0fbb03'
         'e7f6fb6852690810f58c4960e2d23697'
         'e3ba2eecdf0acc589651621c7bfcd9a3'
         'd24a4789466a21ef28c28dad469f76e9'
         'fbc790574e071626457fcdf046add3fd'
         '4a24b7b9fdb95713b377e15df3e820c2'
         'f4c9aed9e5daaa249b0f77feb53648ba'
         '3f7668b86b2324a849d56a3bb32fcdac'
         '1d743694ffdc2ce7a3d685bb312d8180'
         '4b4c691951bc28bf0ddc2e457f4cdd89'
         '72a0cc976ea24e7a0901855565338a0e'
         '4b65e516ff351d275deb0e440ba9724a'
         'ab2c79f721a01a3717bb70be7e980833'
         'c489c91b96346993bf6d6b2ca4e08892'
         '0d592ced2a49e632f4910d216d2e85bd'
         'efaaa22cfc63ee4d22e6ee07e4bbecdb'
         '7df7f7a9a1a7f372e11afd54c22678fc'
         'c0172f6bae9247572b40cac3f24379b5'
         'f7bf53203b6aec9b44bb18407ea74e18'
         'ea0baa002c4ce0d855bcd990c12a046d'
         '512d0d48c7df9606b200db34da04420b'
         '1f66c79515c4ca225fc883d834481bb4'
         '55faabfcd28d6cb3d7d08db2fef7c676'
         '2534b49db1001ededa149d1a835d1adf'
         '865d86c86e444e660d81fc77cd787e33'
         '92431bcaea4d809241422292c4a006e2'
         '126bc01c6a204c99deac5553d3f8ce8f'
         '36186b31eac49611eba0676452f1c35a'
         '798a795409b9f69d16f5f6574d4d2fdc'
         '7c75b4b8fe89267ecccb8f076439c090'
         '6627e917e746fc823557b1d6f47dd69a'
         '1438e8565c98a41880f6e78b53ad0f51'
         '44546ca3cbabe75ad4bf19334d14a35e'
         '795da517d30d131a511d36270cd7f64a'
         'ddcc7c5bc8de6053bf9af7e27d2e3ae9'
         '7cb1cfecc69a3a874987788d51544b57'
         'bf3ffbea999a7b4b2ef3fc98ae162860'
         '21c79d191dd6db9b375e8f9814de70ae'
         '322fc059675012e3305a12ad23e6841e'
         '0780dc99375fbaedb661556839413708'
         'bb27cf11f25ee9f15b05366a0ad8d304'
         '5423b6079119645dc7e19085ca11595e'
         'c8fe9d65e6b791391ff4fb85d92b3df9'
         'e6288810278e89007376fde9d3da39fc'
         'd19d6fb3c538d1e15660fadbed8f7f25'
         '966762c36a93fbe2a595acab849aa31c'
         'fa6f54bb0dcfbc940a330c27713403c1'
         '3d286282c0ca6b893196afd068b71dab'
         '7b9aa304c4bcd556b247b59515de7eb2'
         '34d81221c3a48e9fad44f7d35d2d018a'
         '65c235664b5c97613f07f56ac9ac00aa'
         '5f11c5c95b06700e2090917e1d42ecc7'
         'f36758ce28f259512f9291ee0bcde02f'
         '872733250dcb9ff5473640d9bd9939bd'
         '7d1a12adf192f8b88517df88bb23c732'
         '6f365994b5e9623c431120a46834948d'
         'af3d0863d54d208487f9a1051ec4f7da'
         'b120510e7a5cab17172bb87b3c97b4a7'
         '4520068336fbdc0632d2d92015a7fa97'
         '883b6bd11f2e5bc0636a90c9666daecf'
         'f6d2d2a92178f5a352f85bcf7fad523c'
         'c199f15370ea5c0ac00ec6ab4299e685'
         'fa90f700f5fd40c38f8c932e1b907dff'
         '4c0465bf74ae534027fb871ac397499f'
         '45c90b06311c98a0bcec81ffe59ae209'
         'fda3d2a93d44f1d0fcbd69b49e45232a'
         '4b815cc3ddb43376c5bb61b5029473cc'
         '28474878bbe25e31f6a0d8a562e2f0e2'
         '4160416229739f71ac5ae15ca728682f'
         '0d20afadd204dcf1b240a56ed0db2b63'
         '7d09eba6f1808daf6f4ee81c12e20d1a'
         'e9a203ae0055a8d2c02e58ab8c7a6570'
         '908bdaf9374d176fc0c1e05eceb5d387'
         'a69a48d52daf6ec891be26818d6a0aec'
         '5111456553c0fceeed640e85e392fc92'
         'd99a5c1e887de37ad33f0350693dccf0'
         '122a4491ebc98bc55bdca56429efa36b'
         'b2be8eeb54c6e50e75d8daa5f2278085'
         'ef193c45c0f8cbc01d5775ff602aebd1'
         '194206a2dd625dff4b162a2f7080422a'
         'a4cf2057f0cb2ea155819570f9f074e7'
         'c1087a0487e543ec122b283dcabe3a46'
         '5b490625c7dfaea5a3ef1bb2ffba0aa7'
         'da7d5aa5ec07440748d3e02a19912bb6'
         'cd04ec29acf625cbdc32c39d27388687'
         '9dff0c8065028fa2a7ccd3f779163a20'
         '675c1018d027c73d5726f9d146f85b07'
         '996c082b45daf961ccb85d3c0806add7'
         'b22095b9585978953b0f3bd69f08f589'
         'ac95c7bf69cf83222059873cb6906918'
         '384d6add2357fc2e11b351ef7946f540'
         'b6bcd07a47779a4ac41c79578265635c'
         'd7c10e68aaba2028ba96ae787b699513'
         'a77490618728c22cc3880da51143045c'
         '545c12dc47a107e00095c253513f69d6'
         '8f8c6b28dd824a33cb62af6ce906ed3a'
         'ce3372e0f1d2f12f0900f05e268b08e2'
         '7993b961fedb1d8f4f4ffc89a43c52c8'
         'ea83c54e166d4a700bd967943638faf2'
         '5c4110756f942e20070e673cf50cb9b2'
         'fa4e9410e3a2acaa32dc6b16515fc831'
         '8e46801fd5e1e613e78c7c3f24e0a7df'
         '7ecb4e00568af79bdc61372c31256028'
         '187f91c1dae2066ad41e8f9d8c6b319b'
         'a8ceeadd67aea548e530fa6140d55029'
         '97ced0a6ed80b0dd774a3ab21717b1dd'
         '19478f81723bc960f621c20183a1498b'
         '9c1ab46e9e873b6c2b47f88414d6845b')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
