# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=4.4.2
pkgrel=1
_rcver=${pkgver}.2
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('909e28a83783e475a6ce7f36b32ecfd7'
         'a5402fd3f7c0c95adf3d8b2188074599'
         '9afcdb104121e953faaf2dba74f60f47'
         '293b6f360e9e93a15ee367e113eb09c6'
         '53ab8db0aecf6a52f19ba7adc3938b10'
         'b33b38bc1ae829fc4714d648df17dff7'
         'bddfd435fdbb92c0e9ff87319db4a037'
         'b467269b3967439a9e48a291b01ef3e9'
         '6cc23a98e67c8b4299cfa96ca2ab63c4'
         '904b11290bcdc7b0e5ae9a7c0138a430'
         'c07ba54847f811503e372ed88be01542'
         'c1e28453603542c2edf7d19428b1f9da'
         '2e96611cc174f16cd4b4828178db2574'
         '575fef549e4197706f7d8d2118e4e503'
         '32a41eb982fddb88a8a7a81196a58a30'
         '8ef1b8c9c9a55f472d8f564a624b100d'
         '61a1d0ecce2906fb429bcada3c166638'
         '5710cef47e084c3419710b0a67d3969a'
         '4b8e0e2a0d5aa5c1bf7eea3b03d87eaf'
         '6e62ec2648b51f4bb33281a56874e709'
         '04260f8ee73edeff0646c8eab1df0acc'
         '480a62f698d9d35157fbadaa8936e0cf'
         '35aa32d5f0b6cfc53121b2c60a440317'
         'ae7533f8529e24032ece1cb2051fec58'
         '31e1e69d0cb2e0370f79f99b1b830c76'
         'ce2d44d07db1921fbb56327b03a2cda8'
         'd08723183a739933ef18cedb180cb0f4'
         '1893bfe5df20de9b4a2eae30a03f7268'
         'c125b51675d1dc06f73b167ffdfb0874'
         '101387b2e61c1a8a7a0b11ebab7cd703'
         '71ff6939d0f76b6406f2169b4d63e1d4'
         '718561a2eff00564be6ec68be9f4dc5c'
         'ede111d80b3eba564dfacf51e07b1dbe'
         'b7332a491cf84663a51bbcaa3ada69b6'
         'c2228ac7a276f8af419ebf191340b41e'
         '8dd50e2a4ef3260227dcedf12f4e8917'
         '5cd555a48211b9edb20960e8b248b187'
         'bc18d4a3df038228b4dbd885be2ca7e0'
         '70a7ef7df4791f87f834825fca879e7f'
         '18c1b8fc2ffb24dc4dee6ad665e763d1'
         'ae6446e8c91667936e5f6931b3879eaf'
         'e2fbcb4e1beee46fddf4140130c46b19'
         'b25411a7f6646436dc8346e63751841e'
         '3a71b4b34700f48f7d40a38d4b8ed9b2'
         '909c3f17bcc4913a758b651a2bb9440c'
         'c6f70377f64ebe0f31d155a2c19d2454'
         'cc1658ad7b60f21dbd10d72cedab0c95'
         'd264b7b0a03cef4dc9ccf74b64ff4b30'
         '0fa53c2d15fd6aa58ae38d792ce52f29'
         '28ac57f638636ead4368caab24177431'
         '21a36a7102b72d8b89f76e233afd3564'
         'bd4d12c0ffcec93736aeb7885d6aa67d'
         '5bc95ebc6f3ba81bfc739b3833f67628'
         '79126652d4b66505b5188b4e3378caea'
         'ba081f9555a865509e25b45981047e17'
         '40859c4fab5043b19cd86005cefe98a2'
         'c54e6a719434c7e7ab01005df2e69fbe'
         'f2f08899350bd4384005721cfaadab3e'
         '78089497bc8b53540830da1a32e29405'
         '4a9c986bd7c7329cc67272a261397835'
         '964ca4df79edda45ab63c1dd89ee71d7'
         '713287462c34345cab9ba72cc96b32a7'
         '45799173ade3125220db9aa5836f9637'
         'fb7f555012867774f25af219c2e98042'
         '4991c92c7244179a6bbdc9f18bfce596'
         '68d98f0353f0969c068d1e6eeeeb3290'
         'f93bb41218bb7271589478fc65ccf4f9'
         '81ae11f32e895871c1f2fea02e36b996'
         'f04f9a46db17a08f72fa5c22b3e40d10'
         '444b4a1f2aae3d659688b0df4ec84b4a'
         '54e287f19a897af9a56310978460233a'
         '807ae578230a805048c645d5ef16672c'
         '8b3627666b6417bd8ef9a53003769579'
         '8cf07b37d1518d93b252fa8e55681276'
         'c8aa93f7fffba691a0c7690981b318fd'
         'e55713cfc1adab0d7a4312e34e890b2b'
         '871a29c3fc86a92e035a6013e9ff4b8b'
         '6d5b5427cc43cee4be2e53ae9241c00e'
         '407682899e78b971e36bcb25b0cff8ec'
         '71bab7c67b47f93de748b36a0b699652'
         'ea6aeb38a8f41cfd52dafa58046cfa43'
         'dbfc75f41fb77f1be0de055408f10dc9'
         '1639153691ec5a328b9635fce9da81e5'
         '3ce33460e945a020fafb1ea25c777a92'
         '1e4aa3b7e79df69fb574be16fa751c04'
         '7010db186dd955248112228829b6e3ad'
         '0deaee8f6ec90a49eaa557aec654fae2'
         '800a4673259c791235d48e8e6107570c'
         'cfe258360f8743726ba5e98a09482214'
         '1fded643eb495d659597415d8ad4a9da'
         '9aff1258bf2e9c13f1ec933d1b412390'
         '2332331f97a0b3be2eff446574e66da0'
         '82034db6bb6276b44cae7124f090711c'
         '8e47d37deca58ec4191a7e8209d8cc58'
         'b99f5662e9a9ec0e51aa1e3e9575d1c6'
         '9f97ee93be57a3c91ac2bf967b3cefaf'
         '506221df62bde8c7f7554412a192cd60'
         'c4e45412737736d86aa957a196775e50'
         '3e47ec2c74b6f0d3e97019f0d5b2a65a'
         '2b31f63ad666e9123c18faddd60dd151'
         '25c23855c245246c7afe2bf86bdc708e'
         '3379f8286d6e09a10e76fce2a0a2d136'
         '469bf903cf89a1422e17548d946463c3'
         '80917fa6b5d7de438cab8dcb1d00889c'
         '1d29f7fd38f8c776942c43e82b234153'
         '33b7f74e2fbe811506d2e019efcdfbdb'
         'e72039f0ad971a1b7392291fc4ac8116'
         '9dd2743043ae0cc73ed76346061596be'
         'eefd75c159c0bafdec9f0a4caa63da8c'
         '4319676ed30f65fe3cc8814b39a25049'
         'b88513f379e43e24ff975384bc5e58df'
         '15951e29d06c4a9d88b2fa2208e79337'
         '60a77ea308e90435ade9c99000162d4e'
         '92d5625914a24ebbd6a502e0be210af3'
         '8e599e91e7e6a6cb211a007c3def03f8'
         'a7728ada85a12f188719459c13d798ab'
         'd9c0ba3065559c34de084eb5b715501a'
         '199ee20dd3ba3023269b20649449ca91'
         'bdbaed09b52b9600124b7741ac3c8dc7'
         'c59dcf345cd842c85986e8324de678d2'
         '3a7a5544b1a43163bab7ccaa1b0d7d3e'
         'd0b7d5aa4e38a4741b9e6ebf56ba884f'
         'f7482248f907f2cdafe8ce83d5b2564e'
         '0c8af29b50c01a8b31dc4c86fc601baa'
         'e283dd9cc7646e104af7d03bdde5f7d7'
         '0a5b7f4785e2bb335b25368b9e0aedb3'
         '3e86a9e2311fa43c5a1d1bbdbdd0f376'
         '8a370db4d1509279771e63a04beccdb1'
         '1f8332c75b9d3f4a703e0311182b2808'
         'da9769eff884a2710f2e7acf50ab17e5'
         '29c5fc94cbc96189cb43d6e2e370d169'
         '938c769862ae98a08276bba38217258a'
         '1865938d99a75bfde61a3225b77d5cfd'
         'a18f5cf8f29e2ce3ba0400e4fd6ed225'
         '888a4498eec16964385b3de0c12bae37'
         'dc9bc5a443540e6840aaaffc602f1ded'
         '750b7b514695a5173738e7fb515f7984'
         '28ff30d401627db2c26185b15e2f6aac'
         'c9358d4d93065d13ebb0550ad3d9efde'
         '4593b4c0f2ce1e2437acd8d0d8f62c95'
         '7ec0a43c158bb7dc2a051885d2202ab9'
         '1afc62dcb02a563a207d020e97834a22'
         '6ac6777c8669150d7cfccf53c96bbb36'
         'ad45bb7c4129a434d7a44120c11c9f33'
         'ef0a9d2dfe77faff6cb93bfb06dcdb7f'
         'cf5293f9914a3538aa77553fcbb53b52'
         '6eb1236266a09e5c8e08747563388939'
         'bdde29356ced56fcc01f793965da98b8'
         '8b11cb5c797d1e43ad24bf3bd1e1b7fa'
         '4d75bd24d6d6ff451dc3d873ebebd675'
         'f4884efa7f8d1e273c9533eb8efc29ca'
         'be4740e10654c99081109f9541baaecf'
         '2ba3321251c7392ad74d71230e74ba2a'
         '5c1d24b1061b0e096c18f578f7cda258'
         'd2f3a0c695c5875b9793acff31950235'
         '0409041fc700147df2739a7c27d67fc7'
         'ce9a6151dc2cbf83dde00c5e33547577'
         'b8e9e30e18acc1e30f7655ce1eee0424'
         'b3be3b5e6ea9ed95bca1c6c998cf22bd'
         'a3d05c6fd26e457b46612efedce4a45e'
         'c1135f5854c271a620642b7e53baad38'
         '6c5dc9f472b8bc0c97e989d37d30c9b6'
         '5e63a881fe997b5b165c6aff5c43bc3a'
         'c7f3947cb9c43e7fda8a6cc6d5a0bc0a'
         '2213d375df238e091ef83c1421de5009'
         '978e32558a25eb63f5cd523aa35b4dbe')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
