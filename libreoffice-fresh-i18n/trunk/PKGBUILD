# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=5.2.0
pkgrel=1
_rcver=${pkgver}.4
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('c17725d06999279a8ae959b3c5794c03'
         '353bc46c84de2751f1f8912c13f04a91'
         '5523247a6f58c3b3cdb38c3c1603fb27'
         '29a5dd0e7c4f12d9214553e35d2bdc31'
         '6edcb8e7338eee597d9c9ce9f43ba05c'
         '13deb2d3759875427fc7267ee8581cb6'
         '2cfcdabcb568609da3ef9e7ba6328ca1'
         '953e6401cc66fa6553557e0e60a17ab8'
         '84b24ea06664ee4af537932d7e1b7870'
         '19db3c3dfde8be2a3c6622e572c83ec5'
         'b97740fe4198b507aab7775315acf67f'
         '6a1d8af2031b7dd19242892912826f20'
         'e5b17eb8254655571ddfdb45c8070d7e'
         'ca4ba81e9d9ae985f7fab258e2297b3f'
         'd2f703a4a45f99e66d65cff4bfe84c5b'
         '5c49aa2e6dbf3d8853273cf9d5bd62d0'
         'd0f85878250342c845b7fc773c4c7267'
         'dd8b9e6262691776608c408a41e8dc4f'
         'c2695a24c80bdbd674d1766504e6b96b'
         'd5a3aadaab35873f36017580a2815443'
         '271e36eaf9f4bc1b619c3be4429ace4f'
         '01511ab9171a74b70e54a31bbbe710b7'
         '6af858da062b6ab752f98181ea9b3dd3'
         'a887f37d2d4d17eb74b72d601e2998a2'
         '2bc61ab909e54fe0aa0b424f15633413'
         'fc369f4f315f1afb4c0d5ac3b9f462fb'
         'd3835efcda1babb7896afdb8a3de9ddb'
         '34163e9487a0c9173bb2c1bf539b3777'
         '955c6f697530dea04247663379bd3648'
         '81f317ba8491ab8de12643e27ad2116d'
         '43ed14e4d274a5ff156ca219f8c807c4'
         '9e5a43be02317393134bc984ff1ad231'
         '2c562a28a1916fa3f188b74ecefc266b'
         '41ad13716f76031eea3d985319729872'
         '013388162e6d84dea1bb2441245f8dd6'
         'b2ab18ef6c2f2f5d00022aaacb5a1c03'
         'd085c3e86da590e5287e0cc02e559a0e'
         '8999131818b41d71f3147bcebc77b391'
         '28c519617594fb52577764a9fb1a30a1'
         '16df792af0701be882fe6a473bc3dfe7'
         '15f9bfd7d3901dc84a532ceef4e26beb'
         '8ac2219a3461c8ab38658a3234fdc946'
         'a384f5e4e4884c6edd88a5745b1cb259'
         '3204be2aca264fc1b442ced5916e11a9'
         '84ffaa5e28ba329a5d897e4f0de18f40'
         'd0d7cfb207ccb80f022f0b26cf7429ee'
         '3438dda5bf4c80f90db5ff9b10fc5906'
         '699b8103b076d4513757428a13595a4c'
         '663272e133fa52ee3ff518b7a7d6965f'
         'bb6b1fc2b67c58e772d0c52a9dfb95da'
         '0cbc31c943ba12b17b4b0f96b6d49f1f'
         'fc07d2f63f7b41c6f70dc06c5c24e42c'
         'baa3ba9051ad641aaac8f60534ecfc3d'
         'fceaa1fa602214c361ee9e0dd2993a95'
         '41d075d721355745c353240c61d62d30'
         '37b0e2418b6333c7507e99c1d637806a'
         'f448bc21696493f40e6e4a22184bb31b'
         '4ee5ab1062b7b1f9a41e5e1198dcb4c9'
         '62bc073531556d1f29953ba930a49aaa'
         'fbf8f4d3fdc05ee08ce3070551efba73'
         'e233617320dc30fcdd0d35abfdf1ab26'
         '74a0eccb065744d59d6acb6234c6da9b'
         '13a33d575a4e8bda1b16a1213b7b1387'
         '01c4d5207276a98efead5e7dd34c8a3a'
         '63875cc0e02e2ecbd20318c65ae232bd'
         '4d11e8536f1fae346dcc0d4f18b0a6a3'
         '5f085f08b3e9ff821de9c206873e3c81'
         '557345c1743a5779d019dbec437d084b'
         '21a19ebdd7e75134d6f3091194685ea2'
         '41ac502c20cc8924d258122d1e4ef145'
         '39e1681642b77528f3ff6f629423213c'
         '0ef7fdddd74bb7652a547d49997353b1'
         '027e503928748aed3cde23743ea6a560'
         '4a225d6b7aab9ffb3d5981676df19e2f'
         '42ce83ac9b6350e03398fd34f45c1d57'
         '8c4d88df3d40e24cfb7354fdbcc5d50e'
         '5f4a630d958ab866ee677f8124e1cfa5'
         '83fd12462f3e725e2a5a8bc7b95b563c'
         '38ffd69f4aea82f2b56d971efa87515c'
         'e81bb5e755059f38dff5b16987dc14a1'
         'e82e7c09f7dc4d9b2985d9fa55f74b05'
         '4c8fdad797a84342f4ee99ba94513df4'
         '828d74d3e3ac992c83d06985dded0911'
         'e552017ed380b20fe7317760590a6cef'
         '8b8ea489d01daa073459403625a435f6'
         'cf0e96be245912ba5e87c6c8e31b4ddc'
         '721549013bd07b9cfa1823ff725a6bac'
         'a2ef4396008602cf86c418b0686797bb'
         'f4ea495a2374988c7fc54cd3cedf4536'
         '852850ba1b58b3f4d0db8a7f659e44f1'
         '20c56ec0a28758b6be9e7c665ac80bfc'
         '814e318942036853bbc01378621fd506'
         'e4a2d65986dab59f14e466054dc234d7'
         '4fa20ad53153ea1ea7263d0a311c3283'
         'e21d00d31acffe0cd23f4bee679b8998'
         '611924a2da23d4383fd74466b6c1066c'
         '4e88d2829a9c9528fc657ba8339a2007'
         '5e83a175c5957bc030b93a12ee39d9ab'
         'fa3a2dc9ef2c9d8d4cd7932e66cfd283'
         '47dea7e0f43bcd6abac61d81f3e33891'
         '798077d9bb54dd090bb6d9801ba473e1'
         '611c658bd07de98a22e687f5478bcd8d'
         'c61e6b1f878b814cea85f59f8ece0af1'
         '09c4116ee3b3b1b9128482ad42f9c66a'
         '9f1db0f983d6c2a7231b453f0eb6ed27'
         '514f5fa954d21f3bdb953b820a696ee2'
         '2c203e7ec6cae5068796eb2abac371f7'
         'f830fe2440d8b10cbbdfbf84c7979587'
         '3149d26d6ac738e674f4230a3cdf8a55'
         '5a404a1dae1c6998cb501e11f5a16406'
         '5ca7e02615bf1c15ecc35d2d90d05475'
         'eac2c849f660f8735a1968fbe682943d'
         'd7175c791b434c31e7b3719ac658b262'
         'f7e9921efb63d154347785461a333d37'
         '852d87b79d52ec2e0dc4ee367f87fb64'
         'd598023909e8f59b7252f811a011b286'
         '23806402d21ee39fad7afbf0008c8bc1'
         '519cbea5f716ec9e56eb50f838bc0534'
         '4302159b5b33fd667726275f16a4cabf'
         '193ecc7f078cb6a2dd705828724c2302'
         '5709c166684981c6b0969d0a5c1c30e6'
         'c61c9c0dff10acac78a79954ddea8df3'
         '2cf472080361243caa3e6bf1c397531d'
         'ad2099e85255cf1aed0418b3e85bc9f9'
         '5db3487d60b3e10c3bd867af22bc515f'
         '85ee2198bcdc88b6abd3ed013838d5a8'
         '40e652a34c8d59f51e2280a24d8c8645'
         'd30c29ad6fc96fae56e30ec1c231691d'
         'f03b20b653428c2b14f71fe335e1bd74'
         'ea4e2a59f95d845120463f8d81f6e33b'
         '8142fbc48dc866f1d61ef8e95b3aef58'
         '0e5a3d17c4d3f4c7ce22c1fe84363939'
         '074a4754065e652548354c94f273d151'
         'a31a65b38eb4e4f0b96471909e4af966'
         '888626062ecee49b3bc9069948543550'
         '797d2d87b81ae1d0dc1a9b1a9b5c8190'
         '63173cb197fc218a63759ab6cc4b44ff'
         '85a86774a56666a80de31afbe9aa93f2'
         'df049421c3ef5dc73b8abbf1e36424e4'
         '2b011b4504786ae7de213630829a462c'
         'f246b0169722bc8db32e1f01e455253b'
         'b9b2c80e19de52ca1c53e3d1e89d99b0'
         '49ad6f6327564b0b73f5572800fd3c45'
         'cfef9c976dd59c4d15c53b5843061805'
         'b80aced8e8290d1359b266effe45d0ab'
         '459a466025d08964ddea9b7d7f24fa6d'
         'cf1d37d24cec6ac8bd5664dd96257940'
         '130aff05d1c937dbe708a9d612a9b14f'
         'df562cc119472d570379fdbae9a8e6ef'
         '97747c7c448ede7769e396c2de646e66'
         'fea3bf8f62823054194bb73ccd52ec1e'
         'b3a8dd39b91bd288941ca6db88282c6b'
         '34f150bf71fc8d59c3271ac0332b286f'
         '65851feb53e2e219c23782faac1c9ff6'
         'bdee1486bcc2ec670803ad8ab5b61cab'
         '90c1053037b6df1d4c79a8f1a4cfb6f1'
         'e4314fada1b4125103bc8374b2db47e3'
         '5212f1b3e6e357046b752d3c28beb628'
         '3de2ecc4fe193f59f61f84f3a0667956'
         'dc2d85bb4d98743d1aae3dbac06b3f6b'
         '562cfd386faca6410e2a5724440c4b78'
         'c2be5e9761438f23fa5a5aa3f7815b33'
         '7fe48579cc380fbfa90369f7a95cd162'
         '060393461dcc1e56e7a92970e6b768e1'
         '3d17ca4abe127e85937597645a00bd58'
         '4641b5ddd78558a16f2b946a40b94914')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
