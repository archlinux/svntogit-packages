# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=4.3.3
pkgrel=1
_rcver=${pkgver}.2
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('8347123f1b8b5acbe0abea29d39ea1de'
         '67dde05336c404da090d10dc0e6d0aca'
         '883abe863f3aa6021e3e27ff6cc4e018'
         '6ac2191c0c870388d21ea88a5b6f8208'
         '296b35b7d5c5fce68d3819cd36b0ca9a'
         '16579b82411fe9e73f0861c77417a1bf'
         '3ca7d71c47e7edbbaf1422d55abd27c0'
         '351727acb491d28d1acfd744746ff06c'
         'da84539985003968b27715d0495734dd'
         '850bc0ffc099b596529ce6edd7dcdeff'
         '12b774b1881d4d423eb3048354b2c472'
         '3d795e8b3b41defa312d26f70872457d'
         '0656ebcad46644eb84f38d4c0f0ed5e9'
         '400f93c8612a3c54362bbeb691d6c120'
         'def1c0be985006ff954fe31cdcde0123'
         '4eb6ad1f0cf545785fe31f83f1e7e8a1'
         '4c27ee5b6a6d46e4363398f01a3ded3d'
         '892fab2fb1f5e0754c3d21a7a3b21b03'
         '34c8ea18bbf061c5023f65fea02f6d8b'
         'd7dd4a68b619df2e54808cfb4eaa9161'
         'e8890aef148598864d431187f5eaa2d3'
         '42ed96cb2a30135f34c0ed34b0171165'
         '0627c8c079c4396632b31b970020a432'
         'a981352de06bfff55e42ecf6b01a2097'
         '377a7152d8fc0f22456204835ac82967'
         '5917331083edfae310b832ec35d7daa5'
         '404558c7f59a80ea4ee624e393135860'
         '228f944cce14613ca9c060ffc2a9b2d1'
         'c5cc01daf144480f8cb5067219f16998'
         'a541b623b9ad277251254a3a5a424d10'
         '169103394d665322704971f63d74009f'
         '036469afb93900bfd5b43042bc65c4bb'
         '3783ad688d0de60e2c5ab09a763b8c6c'
         'c0bdf990db899268dc3d871e69261419'
         'f7b45ac7ceb9e4384c0a5ef7c2228b2d'
         '39eef93a253b0340b0817f72ddb5fe9f'
         '843399d22f303cb973f5fe8820f60732'
         '71265e5f61a1fa6a9e1a262313898bce'
         'c47a26ba8456bbee7802648a017ccdbb'
         'b568704dac1d60bf56648a97649e91ba'
         'ae5462fc4e83561f6ddb52933ad9ee84'
         '4dc6888d890cceff18cc8da0a5bbacb6'
         'bf875ea2a68da6bb12c4ec39b58ab505'
         '5fb2a47c248249e15e22b63567cf1bc9'
         'b07a631472c94f56cda6d5a015864693'
         '649d2be2656810394c99ad95664d4b8c'
         '1f73c881ff20d049324a86ebdd85a133'
         'fc3da23e1bba4673064cc66455a656ee'
         '80402a47478dee5962ce7d9a5eba81b8'
         '95f051531ad8e0b609e8f370295652ab'
         '3c3741894e1824015bc9a22dfd98803d'
         '40b8c8a1f1008b2f710af39ddc02405a'
         '8c0349c4bbb700f18e0a0e26cd31b4d5'
         '05191072f4671e229a405eed3589f9c4'
         '593eb65c3f55ff72f7df31bba9abe2f2'
         '89ea12efe5ef90226593f532f6e711e1'
         '404aa11e1fe1088dc787b343a203ad7b'
         '4241b5f5f243e663271cf8119e0111d7'
         '40c2d3cf516e6ae9b2ee7bd37b15e21f'
         '4ed4ec3c04f9ff052e551a1765205a32'
         '18d37811757c2849f85f48af381f5e2a'
         'baba108fb7670d6fd92cb52acbc7483e'
         '307ca59bd35fb3cb5dd31b3720df1975'
         'c34f838b824d2f72b4af876ad156c42a'
         '8c29e47eb31b0207d08c64e24ae0e36c'
         '1425c6eb76d01b19ee4c493f3e3185b7'
         'adef0b483610db52c3da48d445a6fd9d'
         'af9cd0b4a49414f49fc6cdcb11287cf8'
         '9f32372281907d01f761ea782ca88a5b'
         '56d1829896b0ac558727a4fc1273911b'
         '3eab5aee81ba1d5a567440fc09a359a9'
         '1ed29d0b09e43d534838ac954399c51d'
         '5d34eabda7b57c74a0990df8c6f9d70e'
         'd654951d5371b89ef937e1b0a8338f05'
         'b4e10e5d03cfcd7339049e548b17033b'
         '2db170dd38cb1df5e826a1602181cc5f'
         'cb75a2a7328633a96911ec718f4bd2a6'
         '005b810289f398db767b1d3c993d13e6'
         'e119482543a3c9eac8bfcd08540187c5'
         '6691ae5d08d19e2d8de09f50cc3a663c'
         'dc17231ce7e339f12df74cb4125e1238'
         'b97e9ed4e0a735a3b450a6ea1b9421ec'
         'd0b59814c8536ee70c4a6da046b62ddd'
         '3a6c53672b7bc5fc860db6f5cbb3f742'
         '92d383bc7855df2aacd041c9225f3ce3'
         '2d23f6b482b3f68ef89ce7b641501e23'
         '3c928b74a448819750f926dc9b1a4635'
         '11cd4547575b35bdc3a4b703803b198e'
         '38a3cb8c925f4e795a2eaac5c18825cf'
         '3e572b9c57c542bb91c4c1352c651219'
         'f97a2a41ad7b179d8dc0d34a331b4ba6'
         '8d680b4da04715590898f41f0288fe2b'
         'a2292a37a2d9773d8ba654af80b0cb0f'
         '6781c9e5927d898d1f8c6604d2fd2d40'
         'c4e9e52430e032042200f1bb07123657'
         'ac3ec421068975f180dcef3a671f4351'
         'b3324a92a49689b0fc3a8c55abd4e933'
         '5332eaf0636e76ca013278be8e0ce9d7'
         '5a30764b36e5f756aeda4b50d94cd877'
         'a02b38961f990ad3b2b0f1a105aeefe5'
         '9a0568ff630e764b79bb534f406ca3d2'
         'e73ca221daec89bc8216529b7a08a42d'
         '25581e1cc806a18b2a74ea234c6e2861'
         '8b255d3740943d3607b813299ec60057'
         'bcddf88ddacfc85a0826d226057febc2'
         'fa5a5f340c5bdd881c5b48cc10a3e421'
         '6de708e27e9dc64f267422d9b26505a0'
         '863c3ecc1e42f7f0400f4e8fe6b078c9'
         '86034f0589bae141012a2a9f6b22d337'
         '998e91667d93a28ac4f30b70dd7bca4a'
         'fef4906e2afbafdc0f72b0db2cefc487'
         '4e698baa1538678a8d718f2a1fda9555'
         '73c34607b13b1ca5857b1e89e2ff5898'
         '8f7b56dc2d7c8f4ac9ba45f39dafb94d'
         'fb2045468df953154f3828595d5d8f97'
         'b70c45744dde111c3bd1519a93af84ea'
         '9e1596d3e961fdb983fc5b3a2bea6096'
         'c7faabf9aecb12b7a16aa63ea23e3b6c'
         'af843f521b5ecbb1fc1fe4e5563c8218'
         '9a6a814c641d1b3b9bc96584bcf408e3'
         '42f8db8c6541c0e6f5c0b3192f886b26'
         'e7c7d499ef2e136ec65c9be26cad03b3'
         '2e278cf5014f518b4ab1823c527ac1e4'
         'ea6b8d22f655fd739ce520a46afdb6da'
         'fef51b9465efaf8bcc812197295b2de3'
         '12019c5ef16f96b6e8cb202c50eb964e'
         '5e9426a70a0deca99e427be8e11ec2e7'
         'e0a4ce8e7495f70ae1494520b27b9ac6'
         'ab6c99d77ebd2d04525282f8939329d8'
         '736bf365f63ce12dba87c1e7f9d8c530'
         '741c66e665204bb05fb3a6b0848046d8'
         '93d58cbf39d4edcdd0dbbec4fe99641b'
         '65cc79bfeb235f80bf335d4a94d4f0e0'
         '55fa67696bc40b20139c63a787501ec2'
         '1624b53d684b175eb7f0be2e51ee82ad'
         'a8f04aa74fbb85972a1ff08c8f09b4ee'
         '8ee5c2e716fba5f6570e305b692040c9'
         '5923c3ed45a7655d5d4bc094f12a8ab5'
         '3386157d635018a0e3fdedf2064d4556'
         '998ada829ed317868286d00c45969a91'
         'b44f5b4f1f6adb5392c00ab4aa4877e0'
         '4d66497125c0dd664b824d8d77d60c9a'
         'bddefc5f8e3bd5c7862f5ccf0624eca2'
         'dadfec85df3c2c06a0fbbe935b736302'
         '0a061c2bcd8a3673c8afe03caf28459e'
         '6b4f8138ba66377223e2da19f1515bad'
         '1b1cdc8a30cfb739083f4fb419f4472a'
         '6f8e4b5d97a08051c367099964febbb1'
         'a17b61a512e1ece60a1fd54e81c04878'
         '831743618e9ba22146912e9c9c547922'
         '7a5505df4e2dae5d26d7bebc5b7aaf2e'
         '9958b18f95a707a39268b0d5a3c043ef'
         '31f686c836973b74eb50eb08be5c54e5'
         '6d4a307ce89547da0f14036eaa8e8624'
         '1f8d1df73161da45a0c8162b5f603c1f'
         '91262087bc6e58780b2f3962f5ea6d84'
         '4ed56d09558326ac075535cc170b7cce'
         '569b21b5dbafc1542f7a3008d23c436a'
         'ac6eac3e6fdfbc19ea8925cabafeb437'
         'b24b3cf9fe3ad3c95646333e20e76103'
         '10f338d237af2b15e69426b36f4198ab'
         '03a0683a3d62ee26546c82610483c502'
         'a23ee0fdd5613db755291419f0ab5c3d'
         '9337d9a2dc0af4ede5db629b6c023f99'
         'e87c68128eb6350c1c6b5dffe9a92e8d'
         'd77158e4585bd795fb90710137c6c5eb')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
