# $Id$
# Maintainer: Andrea Scarpino <andrea@archlinux.org>
# Contributor: Tobias Powalowski <tpowa@archlinux.org>

pkgbase=soprano
pkgname=soprano-qt5
#pkgname=('soprano-qt4' 'soprano-qt5')
pkgver=v2.9.3.r90.g3e00d37
pkgrel=1
arch=('i686' 'x86_64')
url='http://soprano.sourceforge.net/'
license=('GPL' 'LGPL')
makedepends=('cmake' 'java-environment' 'doxygen' 'qt5-base' 'libiodbc'
             'virtuoso-base' 'redland' 'git')
#makedepends=('cmake' 'java-environment' 'doxygen' 'qt4' 'qt5-base' 'libiodbc'
#             'virtuoso-base' 'redland')
source=("git://anongit.kde.org/soprano.git")
#source=("http://downloads.sourceforge.net/${pkgbase}/${pkgbase}-${pkgver}.tar.bz2")
md5sums=('SKIP')

pkgver() {
  cd ${pkgbase}
  git describe --long | sed -E 's/([^-]*-g)/r\1/;s/-/./g'
}

prepare() {
  mkdir build
  mkdir build-qt5
}

build() {
#  cd build
  # we need the rpath
#  cmake ../${pkgbase}-${pkgver} \
#    -DCMAKE_BUILD_TYPE=Release \
#    -DCMAKE_SKIP_RPATH=OFF \
#    -DCMAKE_INSTALL_PREFIX=/usr \
#    -DSOPRANO_DISABLE_CLUCENE_INDEX=ON \
#    -DQT_QMAKE_EXECUTABLE=/usr/bin/qmake-qt4

  cd build-qt5
  cmake ../${pkgbase} \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_SKIP_RPATH=OFF \
    -DCMAKE_INSTALL_PREFIX=/opt/kf5 \
    -DSOPRANO_DISABLE_CLUCENE_INDEX=ON \
    -DQT5_BUILD=TRUE
  make
}

package_soprano-qt4() {
  pkgdesc='A library which provides a highly usable object-oriented C++/Qt4 framework for RDF data'
  depends=('qt4' 'libiodbc' 'virtuoso-base' 'redland')
  conflicts=('soprano')
  provides=('soprano')
  replaces=('soprano')

  cd build
  make DESTDIR="${pkgdir}" install
}

package_soprano-qt5() {
  pkgdesc='A library which provides a highly usable object-oriented C++/Qt5 framework for RDF data'
  depends=('qt5-base' 'libiodbc' 'virtuoso-base' 'redland')

  cd build-qt5
  make DESTDIR="${pkgdir}" install
}
